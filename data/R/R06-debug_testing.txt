R06-debug_testing






========================================
Rè¯­è¨€å¸¸è§: æ— æŠ¥é”™ä¿¡æ¯çš„é”™è¯¯
----------------------------------------
1. å¦‚æœå¸ƒå°”å€¼å‘é‡åŒ…å«äº†NAï¼Œåˆ™å¯¹æ•°æ®æ¡†å–å­é›†æ—¶ç»“æœå¯èƒ½å¼‚å¸¸

# NA in bool array Error:
arr=c( rep(T, 50), rep(NA, 50), rep(F, 50) )
head(arr)
tail(arr)
str(arr) #150
dim(iris)


> iris[arr, ] |> dim() #100 5 #100æ¡ï¼šä¼¼ä¹ä¸å¯¹ï¼ŒTå’ŒNAéƒ½ç»™å‡ºæ¥äº†
[1] 100   5
> iris[which(arr), ] |> dim() #50 æ¡ï¼šç”¨whichåªç»™å‡ºTçš„å€¼
[1] 50  5


# æ£€æŸ¥ä¸ºä»€ä¹ˆï¼Ÿ
table(arr) #æ€»å’Œä¸å¯¹ 100


# ç›´æ¥è¯æ®ï¼Œå‘ç°æœ‰NA
unique(arr) #TRUE    NA FALSE




2.






========================================
Debugging: Rè¯­è¨€è°ƒè¯•ä»£ç 
----------------------------------------
å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ä½ è‡ªç„¶å¯ä»¥é€šè¿‡printä¸€äº›å‚æ•°ä¹‹ç±»çš„æ–¹æ³•è¿›è¡Œdebug,ä½†æ˜¯Ræˆ–RStudioæä¾›çš„ä¸€äº›ä»£ç è°ƒè¯•å·¥å…·è¿˜æ˜¯èƒ½ä¸ºä½ æä¾›ä¸€äº›æœ‰ç”¨çš„å°è¯•ã€‚
è¿™äº›å·¥å…·åŒ…æ‹¬ï¼štracebackã€browserã€debugã€debugonceã€traceå’Œrecoverå‡½æ•°ã€‚

ä¸€èˆ¬debugåŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼Œé¦–å…ˆæ˜¯å®šä½ä»£ç é”™è¯¯å‘ç”Ÿçš„ä½ç½®ï¼Œç„¶åæ˜¯æ‰¾å‡ºä»£ç å‘ç”Ÿé”™è¯¯çš„åŸå› å¹¶è§£å†³



1. å…¶ä¸­ç¬¬ä¸€æ­¥å¯ä»¥å€ŸåŠ©tracebackå‡½æ•°æ¥å®Œæˆ
traceback
Rè¯­è¨€ä¸­çš„å‡½æ•°è°ƒç”¨æŠ¥é”™ï¼Œä¸€èˆ¬ä¸æ˜¯å¾ˆç²¾ç¡®ï¼Œå¾ˆéš¾æŸ¥æ‰¾åˆ°å‡ºé”™çš„å…·ä½“åŸå› ã€‚
å¾ˆå¤šRå‡½æ•°ä¹‹é—´éƒ½ä¼šå­˜åœ¨äº’ç›¸è°ƒç”¨çš„æƒ…å†µï¼Œå¦‚ä½•ç¡®å®šå‡ºé”™çš„å‡½æ•°å¾€å¾€æ˜¯ä¸ªéš¾é¢˜ã€‚
tracebackå‡½æ•°å¯ä»¥å¸®åŠ©ä½ ç²¾ç¡®å®šä½é”™è¯¯çš„ä½ç½®ã€‚


ä¾‹å­: 
first<-function()second()
second<-function()third()
third<-function()fourth()
fourth<-function()fifth()
fifth<-function()bug()

ä¸Šè¿°å‡½æ•°éƒ½åœ¨è°ƒç”¨ä¸‹ä¸€ä¸ªå‡½æ•°ï¼ˆé™¤äº†æœ€åä¸€ä¸ªå‡½æ•°ï¼‰
ç”±äºbugå‡½æ•°ä¸å­˜åœ¨ï¼Œè¿è¡Œfirst()å°†ä¼šæŠ¥é”™
Error in bug() : could not find function "bug"

> first()
 Error in bug() : could not find function "bug" 
> traceback() #å¯è§ç¬¬ä¸€æ¡å°±æ˜¯é”™è¯¯çš„ä½ç½® fifth()å‡½æ•°çš„ç¬¬ä¸€è¡Œ
5: fifth() at #1
4: fourth() at #1
3: third() at #1
2: second() at #1
1: first()




ref:
https://blog.csdn.net/xiaohukun/article/details/76659515



========================================
|-- é€è¡Œæ£€éªŒæ¨¡å¼ options(error=recover)
----------------------------------------

1. å…ˆç”¨ traceback åŸºæœ¬å®šä½åˆ°è¿™ä¸€è¡Œã€‚
ç„¶åæ‰§è¡Œçœ‹å‡½æ•°å†…éƒ¨ã€‚

set.seed(2021)
carrier<-rep(c(0,1), c(100,200)) #æºå¸¦è€…
null.y<-rnorm(300) #éšæœºåˆ†å¸ƒçš„å¯èƒ½æ€§ï¼Ÿ
alt.y<-rnorm(300, mean=carrier/2) #æºå¸¦è€…å¯èƒ½æ€§é«˜

one.test <- function(x,y) {
	xstar<-sample(x)
	mean(y[xstar==1])-mean(y[xstar==0])
}

ywrong=data.frame( rnorm(300, mean=carrier/2) ) #ä¸æ˜¯vectorï¼Œé”™å†™æˆäº† data.frame

one.test(carrier, ywrong)
# Error in `[.data.frame`(y, xstar == 1) : undefined columns selected
è¿™æ—¶å€™æˆ‘ä»¬æƒ³æŸ¥ä¸€ä¸‹å½“æ—¶ç¯å¢ƒå†…çš„å˜é‡ï¼Œ

> options(error=recover) ##è¿›å…¥äº‹ååˆ†ææ¨¡å¼
> one.test(carrier,ywrong)
Error in `[.data.frame`(y, xstar == 1) : undefined columns selected

Enter a frame number, or 0 to exit   

1: one.test(carrier, ywrong)
2: #3: mean(y[xstar == 1])
3: #3: y[xstar == 1]
4: #3: `[.data.frame`(y, xstar == 1)

Selection: 1
Called from: mean(y[xstar == 1])
Browse[1]> str(xstar)
 num [1:300] 1 1 1 1 1 1 1 1 1 1 ...
Browse[1]> str(y)
'data.frame':	300 obs. of  1 variable:
 $ rnorm.300..mean...carrier.2.: num  0.149 -0.312 -1.26 0.052 0.204 ...

#é€€å‡ºäº‹ååˆ†ææ¨¡å¼
ç‚¹å‡»å‘½ä»¤è¡Œä¸Šé¢çš„ stopã€‚
> options(error=NULL)










========================================
|-- è°ƒè¯•å‡½æ•° stop('sth')ï¼šæŠ¥ Error
----------------------------------------
é…åˆifï¼Œç›¸å½“äºæ–­è¨€ã€‚

ä¾‹1: è¯»å–æ–‡æœ¬ç¬¬xè¡Œ
fn2=function(x=2){
  print('line1')
  if(x<0){
    stop( paste('Stoped here: x should be greater than 0; but x=',x) )
  }
  print('line2')
}

> fn2(10)
[1] "line1"
[1] "line2"

> fn2(-1)
[1] "line1"
Error in fn2(-1) : Stoped here: x should be greater than 0; but x= -1




ä¾‹2ï¼šå¦‚æœé™¤æ•°ä¸º0åˆ™æŠ¥é”™
for(y in -2:2){
  if(y==0){
    stop("Divided by 0")
  }
  print(1/y)
}
# è¾“å‡º: 
[1] -0.5
[1] -1
Error: Divided by 0





========================================
|-- å‡½æ•°çš„è°ƒè¯•debug å’Œæ€§èƒ½åˆ†æ system.time()
----------------------------------------

ä¸€ã€å‡½æ•°çš„è°ƒè¯• debug
1.æ‰‹åŠ¨æ·»åŠ  print(xx)ï¼Œ éšæ—¶æŸ¥çœ‹å˜é‡ï¼Œåˆ¤æ–­å‡ºé”™ä½ç½®ã€‚
ç¼ºç‚¹ï¼šæ¯”è¾ƒç¹çï¼Œç‰¹åˆ«æ˜¯ç¨‹åºè¾ƒé•¿çš„æ—¶å€™ã€‚

2.ä½¿ç”¨Rçš„è°ƒè¯•å·¥å…·ã€‚
(1) debug(f)å‡½æ•°å¯ä»¥æŠŠå‡½æ•°f()è®¾ç½®æˆè°ƒè¯•çŠ¶æ€ï¼Œæ„å‘³ç€æ¯æ¬¡è°ƒç”¨f()éƒ½ä¼šè¿›å…¥è¿™ä¸€çŠ¶æ€ã€‚
å–æ¶ˆè¿™ä¸€çŠ¶æ€éœ€è°ƒç”¨ undebug(f)ã€‚
åœ¨2.10ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ debugonce()ä»£æ›¿ï¼Œä»…æ£€æŸ¥æ¼æ´ä¸€æ¬¡ã€‚


(2)ç¨‹åºè°ƒè¯•å·¥å…·è¿˜èƒ½è·Ÿè¸ªè¿è¡Œæ­¥éª¤ï¼Œè¿›è€ŒåŠ æ·±å¯¹ç¨‹åºå¤„ç†è¿‡ç¨‹çš„ç†è§£

#é€’å½’çš„åŸç†ï¼šå°†xç±»å‹çš„åŸå§‹é—®é¢˜é™çº§ä¸ºä¸€ä¸ªæˆ–åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ›´å°çš„åŒç±»å‹é—®é¢˜ï¼Œç„¶åå¯¹æ¯ä¸ªè¾ƒå°é—®é¢˜è°ƒç”¨f()å‡½æ•°è‡ªèº«ï¼Œç›´åˆ°è¾¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œå†å°†å„ä¸ªå°é—®é¢˜çš„ç»“æœå‘ä¸Šè¿”å›å¹¶æ•´ç†æ¥è§£å†³é—®é¢˜ã€‚

#é€’å½’ç®—æ³•æ’åº
qs=function(x){
  if(length(x)<=1) return(x)
  pivot=x[1]
  therest=x[-1]
  sv1=therest[therest<pivot]
  sv2=therest[therest>=pivot]
  sv1=qs(sv1)
  sv2=qs(sv2)
  return(c(sv1,pivot,sv2))
}
a=c(8,7,20,9,45,3)
qs(a)
# [1]  3  7  8  9 20 45

#ä½¿ç”¨è°ƒè¯•å·¥å…·ï¼Œè·Ÿè¸ªä»£ç 
#trace code
debugonce(qs)
qs(a)
ç„¶åå›è½¦æŸ¥çœ‹ä¸‹ä¸€æ­¥ï¼Œæˆ–è€…è¾“å…¥å˜é‡å›è½¦ï¼ŒæŸ¥çœ‹å½“å‰å˜é‡çš„å€¼ã€‚




äºŒã€æ€§èƒ½ä¼˜åŒ–
https://www.zhihu.com/question/23589055
1.è·Ÿè¸ªè¿è¡Œçš„æ—¶é—´
add=function(a,b){
	return(a+b)
}

æ–¹æ³•1ï¼š
time1=Sys.time();
add(1,2);
time2=Sys.time();
print(paste("æ¶ˆè€—æ—¶é—´",time2-time1));


æ–¹æ³•2ï¼šã€æ¨èã€‘
system.time(add(1,2))
ç”¨æˆ·user ç³»ç»Ÿsystem æµé€elapsed 
0.10 0.00 0.09 


ä¸‰ä¸ªæ•°å­—åˆ†åˆ«è¡¨ç¤º 
user:æ¶ˆè€—åœ¨åº”ç”¨ç¨‹åºï¼ˆéæ“ä½œç³»ç»Ÿéƒ¨åˆ†ï¼‰æ‰§è¡Œçš„æ—¶é—´ï¼›
system: ä½å±‚æ“ä½œç³»ç»Ÿæ‰§è¡Œï¼ˆå¦‚ç£ç›˜è¯»å†™ç­‰ï¼‰éƒ¨åˆ†çš„æ—¶é—´ï¼›
elapsed:æ˜¯ç»è¿‡çš„æ€»æ—¶é—´ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯å‰ä¸¤è€…çš„æ€»å’Œï¼‰ã€‚
ä¸€èˆ¬ä¼˜åŒ–æ—¶ä¸»è¦å…³æ³¨useræ—¶é—´ã€‚





2.é¿å…ä½¿ç”¨forå¾ªç¯ï¼Œä¼˜å…ˆä½¿ç”¨å‘é‡åŒ–æ“ä½œ

x=runif(1e6)
y=runif(1e6)

#å‘é‡åŒ–
system.time(z<-x+y) #è¿™é‡Œä¸èƒ½ä½¿ç”¨=ï¼Œå¦åˆ™ä¼šè¢«è®¤ä¸ºæ˜¯ä¼ å…¥çš„å‚æ•°è€ŒæŠ¥é”™
# ç”¨æˆ· ç³»ç»Ÿ æµé€ 
# 0.01 0.00 0.02 

#forå¾ªç¯
z=vector(length=1e6)
system.time(for(i in 1:length(x)) z[i]=x[i]+y[i])
# ç”¨æˆ· ç³»ç»Ÿ æµé€ 
# 0.13 0.00 0.12 #ä¸ºä»€ä¹ˆelapseæ¯”userè¿˜å°å‘¢ï¼Ÿä¸æ¸…æ¥š


å¯è§ï¼Œå‘é‡åŒ–(0.01s)è¿è¡Œé€Ÿåº¦è¿œè¿œé«˜äºforå¾ªç¯(0.13s)ã€‚

å½“ç„¶ï¼Œé€Ÿåº¦çš„æå‡æ˜¯ä»¥æ›´å¤šå†…å­˜æ¶ˆè€—ä¸ºä»£ä»·çš„ã€‚æ—¶é—´å’Œç©ºé—´çš„æƒè¡¡ç»å¸¸æ— æ³•é¿å…ã€‚






========================================
|-- tryCatch() åº”å¯¹å¯èƒ½çš„é”™è¯¯ï¼Œä¿è¯ç¨‹åºç»§ç»­è¿è¡Œ
----------------------------------------
1. åŸºç¡€ç¤ºä¾‹

(1) errorå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯å½“å‰æŠ¥é”™ï¼Œè¾“å‡ºæ˜¯æŠ¥é”™è¾“å‡ºçš„æ–‡æœ¬
msg <- tryCatch({
    text[seq(which(text == "")[1] + 1, length(text), 1)]
  }, error = function(e) {
    print(e)
    paste0("Error 01")
})
## <simpleError in text == "": comparison (1) is possible only for atomic and list types>
msg
## [1] "Error 01"



(2) æ”¯æŒ finally è¯­å¥ 

> tryCatch(ls[1], finally = print("The finally cmd"))
Error in ls[1] : object of type 'closure' is not subsettable
[1] "The finally cmd"





2. å¾ªç¯ä¸­ï¼Œå¦‚ä½•åœ¨æŠ¥erroråç»§ç»­è¿è¡Œåé¢çš„ä»£ç ï¼Ÿ

# i=3çš„æ—¶å€™ä¼šæŠ¥é”™
testFUN=function(i){
  if(i==3){
    ls[i]
  }else{
    print(i)
  }
  print("hello")
}

> testFUN(1)
[1] 1
[1] "hello"

> testFUN(3)
Error in ls[i] : object of type 'closure' is not subsettable


# i=3æŠ¥é”™åç»§ç»­è¿è¡Œi=4
for(i in 1:4){
  tryCatch({
	testFUN(i)
  },error = function(e){  cat("Error: The input is ",i,"\n") }
  )
  print( paste("------>", i, " is done!") )
}

è¾“å‡ºï¼š
[1] 1
[1] "hello"
[1] "------> 1  is done!"
[1] 2
[1] "hello"
[1] "------> 2  is done!"
Error: The input is  3 
[1] "------> 3  is done!"
[1] 4
[1] "hello"
[1] "------> 4  is done!"

å¯è§ï¼Œi=3æ—¶æ²¡æœ‰è¾“å‡º helloï¼Œè™½ç„¶æŠ¥é”™äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æ•è·å¹¶å¤„ç†äº†ï¼Œ
æ‰€ä»¥ç¨‹åºå¹¶æ²¡æœ‰åœæ­¢ï¼Œè€Œæ˜¯ç»§ç»­è¿è¡Œä¸‹ä¸€ä¸ªå¾ªç¯ã€‚




========================================
|-- æ€ä¹ˆèƒ½ä¼‘çœ 2så†æ‰§è¡Œï¼Ÿ
----------------------------------------
1. ç³»ç»Ÿä¼‘çœ å‡ ç§’ï¼Œç”¨Sys.sleep è¯­å¥ã€‚
for(i in 1:3){
  print(i)
  Sys.sleep(2)
}

å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡ã€‚







========================================
Testing: ä½¿ç”¨ testthat åŒ…åš Unit test (Rå•å…ƒæµ‹è¯•)
----------------------------------------

# å®‰è£…åŒ…ï¼Œç•¥ã€‚
if (!require(testthat)) install.packages('testthat')


1. ç®€å•ä½¿ç”¨

(1) ä½¿ç”¨å‡½æ•° test_that() æ¯”è¾ƒè®¡ç®—ç»“æœå’ŒæœŸæœ›å€¼ï¼Œå¹¶æ–­å®šè®¡ç®—ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
testthat uses test_that() function to create a test and uses expectations for unit testing of code. An expectation allows us to assert that the values returned by a function match the ones we should get. 

å‡½æ•°ç»“æ„ï¼š
library("testthat")
test_that(desc, code)

test_that("Message to be displayed",
          { expect_equal(function_f(input x), expected_output_y)
            expect_equivalent(function_f(input x), expected_output_y)
            expect_identical(function_f(input x), expected_output_y)
            .
            .
            .
          })


è¯¥åŒ…ä¸­çš„æµ‹è¯•å‡½æ•°æœ‰è¶…è¿‡20ä¸ªï¼Œæ ¹æ®éœ€è¦æŸ¥æ‰¾:
There are more than 20 expectations in the testthat package.



https://www.geeksforgeeks.org/unit-testing-in-r-programming/





========================================
|-- æµ‹è¯•å‡½æ•°
----------------------------------------

(2) å†™ä¸€ä¸ªæµ‹è¯•å‡½æ•°

ä¾‹å­1ï¼šç®€å•å‡½æ•°çš„æµ‹è¯•
doubleMe=function(x){ x*2 }

# æµ‹è¯•
test_that("Not equal when input c(2,0,-2)",
          { expect_equal(doubleMe(2), 4)
            expect_equal(doubleMe(0), 0)
            expect_equivalent(doubleMe(-2), -4)
          })
# Test passed ğŸŒˆ



ä¾‹å­2: æµ‹è¯•å‡½æ•°å†…å¯ä»¥è¿ç®—
Fibonacci <- function(n){
  a <- 0
  b <- 1
  for (i in 1:n){
    temp <- b
    b <- a
    a <- a + temp
  }
  return(a)
}

# æµ‹è¯•ï¼Œä½¿ç”¨é‡‘æ ‡å‡†ç»™å‡ºæœŸæœ›å€¼
test_that("Test Fibo(15)",{
  phi <- (1 + sqrt(5))/2
  psi <- (1 - sqrt(5))/2
  expect_equal(Fibonacci(15), (phi**15 - psi**15)/sqrt(5))
})





========================================
|-- æµ‹è¯•æ–‡ä»¶: å¯åŒ…å«å¤šä¸ªæµ‹è¯•å‡½æ•°
----------------------------------------

(3) å†™ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶(åŒ…å«1ä¸ªåŠä»¥ä¸Šçš„æµ‹è¯•å‡½æ•°)

ä¾‹å­: é˜¶ä¹˜å‡½æ•°
factorial <- function(n) {
  if(n == 0) {
	return(1) 
  }else{
    return(n * factorial(n - 1))
  }
}


# import testthat package
library(testthat)
# use expect_that to create tests
test_that(
  "Factorial of number $n",
  {
    expect_equal(factorial(5), 120)
    expect_identical(factorial(2), 2)
    expect_equal(factorial(8), 40320)
  }
)


source("your_file_path")  # This is only needed if your project is not a package

è¦æŒ‰ç…§ä¸€å®šçš„æ–‡ä»¶ç›®å½•ç»„ç»‡ä»£ç ã€‚ä¸€ä¸ªRæ–‡ä»¶å¤¹æ”¾ä»£ç ï¼Œä¸€ä¸ª tests/testthat æ–‡ä»¶å¤¹æ”¾æ‰€æœ‰çš„æµ‹è¯•è„šæœ¬ã€‚


ç„¶åä»Ræ§åˆ¶å°ï¼Œ
è¿è¡Œä¸€ä¸ªæµ‹è¯•æ–‡ä»¶çš„æ‰€æœ‰æµ‹è¯•ï¼š test_file("./path/to/file")
æˆ–è€…è¿è¡Œä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æµ‹è¯•ï¼š test_dir("./path/to/folder")

ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª reporter= å‚æ•°ï¼Œæœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥æä¾›ï¼š
- progress  å¸¦è¿›åº¦æ¡ï¼ˆé»˜è®¤ï¼‰ it is the default value 
- minimal   æœ€ç®€æŠ¥å‘Š for a minimal report
- location   shows the file, line, and column of the test run (failed or otherwise),
- debug    allows you to debug interactively a failing test and more.

> test_dir("./path/to/folder", reporter=c("minimal", "location"))



## æµ‹è¯•æ–‡ä»¶çš„ä¾‹å­:
$ cat tests/test_1.R 
library(testthat)
# use expect_that to create tests
test_that(
  "Factorial of number <=3",
  {
    expect_equal(factorial(0), 1)
    expect_identical(factorial(1), 1)
    expect_equal(factorial(2), 2)
    expect_equal(factorial(3), 6)
  }
)
test_that(
  "Factorial of number >3",
  {
    expect_equal(factorial(5), 120)
    expect_identical(factorial(2), 2)
    expect_equal(factorial(8), 40320)
  }
)


> test_file("tests/test_1.R")

â•â• Testing test_1.R â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[ [ FAIL[ FAIL 0 | [ FAIL 0 | WARN[ FAIL 0 | WARN 0 | [ FAIL 0 | WARN 0 | SKIP[ FAIL 0 | WARN 0 | SKIP 0 | FAIL 0 | WARN 0 | SKIP 0 | PASS 0 | WARN 0 | SKIP 0 | PASSWARN 0 | SKIP 0 | PASS 0 | SKIP 0 | PASSSKIP 0 | PASS 0 | PASSPASS 7 ] Done!



> test_file("tests/test_1.R", reporter=c("minimal") ) #è¿™è¾“å‡ºå¤Ÿç®€å•
.......

> test_file("tests/test_1.R", reporter=c("minimal", "location") )
Start test: Factorial of number <=3
.  test_1.R:4:5 [success]
.  test_1.R:5:5 [success]
.  test_1.R:6:5 [success]
.  test_1.R:7:5 [success]
End test: Factorial of number <=3

Start test: Factorial of number >3
.  test_1.R:13:5 [success]
.  test_1.R:14:5 [success]
.  test_1.R:15:5 [success]
End test: Factorial of number >3







========================================
|-- æµ‹è¯•æ–‡ä»¶å¤¹ï¼šå¯åŒ…å«å¤šä¸ªæµ‹è¯•æ–‡ä»¶
----------------------------------------

(4) æµ‹è¯•æ–‡ä»¶å¤¹
library(testthat) 
source("path/to/fibo.R") #è¦è½½å…¥å¾…æµ‹è¯•çš„å‡½æ•°
test_results <- test_dir("path/to/tests", reporter="summary")
test_results # è€—æ—¶åˆ†æ
You'll see each file and each function inside the files that were tested, and also whether the test was skipped, failed


$ cat tests/test_2.R
test_that("Test Fibo(15)",{
  phi <- (1 + sqrt(5))/2
  psi <- (1 - sqrt(5))/2
  expect_equal(Fibonacci(15), (phi**15 - psi**15)/sqrt(5))
})

$ ls tests/
test_1.R  test_2.R


# å¼€å§‹æµ‹è¯•
> test_dir("tests/", reporter=c("minimal", "location") )
Start test: Factorial of number <=3
.  test_1.R:4:5 [success]
.  test_1.R:5:5 [success]
.  test_1.R:6:5 [success]
.  test_1.R:7:5 [success]
End test: Factorial of number <=3

Start test: Factorial of number >3
.  test_1.R:13:5 [success]
.  test_1.R:14:5 [success]
.  test_1.R:15:5 [success]
End test: Factorial of number >3

Start test: Test Fibo(15)
.  test_2.R:4:3 [success]
End test: Test Fibo(15)


> rs=test_file("tests/test_1.R", reporter=c("summary") )
> rs
      file context                    test nb failed skipped error warning  user system  real passed
1 test_1.R       1 Factorial of number <=3  4      0   FALSE FALSE       0 0.013      0 0.013      4
2 test_1.R       1  Factorial of number >3  3      0   FALSE FALSE       0 0.004      0 0.004      3




å¦‚æœä½ æƒ³è¦ä¸€ä¸ªæ²¡æœ‰bugã€æ ¼å¼è‰¯å¥½çš„ä»£ç ï¼Œå•å…ƒæµ‹è¯•æ˜¯å¿…è¦çš„ã€‚
Unit testing is necessary if you want a bug free, well-formed code.



ref:
https://www.geeksforgeeks.org/unit-testing-in-r-programming/
https://www.r-bloggers.com/2016/03/unit-testing-with-r/
https://testthat.r-lib.org/




========================================
RåŒ…çš„æµ‹è¯• //todo
----------------------------------------

https://r-pkgs.org/tests.html







========================================
----------------------------------------





========================================
----------------------------------------


========================================
----------------------------------------


========================================
----------------------------------------





========================================
----------------------------------------


========================================
----------------------------------------


========================================
----------------------------------------





========================================
----------------------------------------


========================================
----------------------------------------


========================================
----------------------------------------


