linuxæœåŠ¡


https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-private-network-dns-server-on-ubuntu-16-04

BIND - The most widely used Name Server Software
https://www.isc.org/downloads/bind/

Bind9: https://wiki.debian.org/Bind9

https://help.ubuntu.com/community/BIND9ServerHowto?_ga=1.92154330.1762401746.1471129044
https://help.ubuntu.com/lts/serverguide/dns-configuration.html?_ga=1.92154330.1762401746.1471129044

http://blog.sina.com.cn/s/blog_6151984a0100f1f3.html

(test with Ubuntu1604 is not OK yet.)
(test with CentOS6.8)


UbuntuæœåŠ¡å™¨å‘½ä»¤è¡Œç¯å¢ƒä¸‹VirtualBoxçš„å®‰è£…å’Œç®¡ç†
UbuntuæœåŠ¡å™¨iptablesé˜²ç«å¢™é…ç½®
UbuntuæœåŠ¡å™¨DNSåŠDHCPé…ç½®
UbuntuæœåŠ¡å™¨OpenVPNé…ç½®
UbuntuæœåŠ¡å™¨MySQLæ•°æ®åº“çš„å®‰è£…ã€é…ç½®åŠä¼˜åŒ–
UbuntuæœåŠ¡å™¨rsyncï¼rsnapshotå¤‡ä»½ç®¡ç†å®‰è£…åŠé…ç½®


========================================
Linuxç³»ç»ŸæœåŠ¡åŸºç¡€
----------------------------------------
1.
æœåŠ¡ï¼ˆServiceï¼‰æ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿåå°çš„ä¸€ä¸ªæˆ–å¤šä¸ªç¨‹åºã€‚ä¸€èˆ¬æ˜¯ç»™ç”¨æˆ·æˆ–è€…å…¶ä»–æœºå™¨æä¾›æœåŠ¡ã€‚
æœåŠ¡é€šå¸¸ä¸ä¸­æ–­è¿è¡Œã€éšæ—¶æ¥æ”¶è¯·æ±‚ã€æä¾›æŸé¡¹æœåŠ¡ã€‚

æœåŠ¡åˆ†ä¸ºæœ¬åœ°æœåŠ¡å’Œç½‘ç»œæœåŠ¡ã€‚

ç”¨æˆ·ã€è®¡ç®—æœºé€šè¿‡è®¿é—®å›ºå®šçš„IPå’Œç«¯å£å·è®¿é—®æœåŠ¡å™¨çš„æŸé¡¹ç½‘ç»œæœåŠ¡ã€‚
	- httpæœåŠ¡é»˜è®¤80ç«¯å£ã€‚
å¸¸è§å…¶ä»–æœåŠ¡ï¼š
	- é‚®ä»¶æœåŠ¡mail
	- æ–‡ä»¶å…±äº«ï¼š ftpã€SMBã€HTTP
	- ç½‘æ¸¸
	- åŸŸåæœåŠ¡DNS



2.
System Væ˜¯æ—©æœŸAT&Tçš„æ“ä½œç³»ç»Ÿï¼Œç°ä»Šlinuxçš„æœåŠ¡ç®¡ç†ä½“ç³»å°±æ˜¯æ²¿ç”¨System Vçš„æœåŠ¡ç®¡ç†ç³»ç»Ÿã€‚
	7ä¸ªè¿è¡Œçº§åˆ«ã€‚é»˜è®¤3æ˜¯å‘½ä»¤è¡Œï¼Œ5æ˜¯å›¾å½¢ç•Œé¢ã€‚
	System Vå®šä¹‰çš„è¿è¡Œçº§åˆ«çš„æ¦‚å¿µ
		- 0 å…³æœº
		- 3 å¤šç”¨æˆ·æ¨¡å¼
		- 5 X11å›¾å½¢åŒ–æ¦‚å¿µ
		- 6 é‡æ–°å¯åŠ¨
	æ¯ä¸ªçº§åˆ«ä¸‹éƒ½æœ‰å¯¹åº”å¯åŠ¨å’Œä¸å¯åŠ¨çš„æœåŠ¡ã€‚
	
	System Vå®šä¹‰initä¸ºç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œpid=1,initæŸ¥çœ‹/etc/inittabä¸­é»˜è®¤è¿è¡Œçº§åˆ«å¯åŠ¨å¯¹åº”çš„æœåŠ¡ã€‚å¯¹åº”/etc/init.d/æ–‡ä»¶å¤¹ä¸‹çš„è„šæœ¬ã€‚
	
	
	serviceå‘½ä»¤å¯ä»¥æ§åˆ¶è¿™äº›æœåŠ¡ï¼š
		service æœåŠ¡å [start|stop|restart|status]
	æ¯”å¦‚ï¼š
		wjl@ubuntu$ service networking restart
		wjl@centOS$ service network restart
		$ service sshd status 
	ä¹Ÿå¯ä»¥ç”¨pså‘½ä»¤æŸ¥æ‰¾æŸä¸ªæœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š
$ ps -e | grep sshd
1865 ? 00:00:00 sshd
æˆ–è€…
$ ps -aux | grep sshd



3.
æ€ä¹ˆç¡®å®šå“ªä¸ªæœåŠ¡å¯ä»¥å¼€æœºè¿è¡Œï¼Ÿ

ç”±è¿è¡Œçº§åˆ«å®šä¹‰ï¼Œå¯¹åº”çš„æ–‡ä»¶/etc/rc[0-6].dæ–‡ä»¶å¤¹ã€‚
$ runlevel 
N 5 #å½“å‰è¿è¡Œçº§åˆ«æ˜¯5

$cd /etc/rc5.d/
$ls -l  
é‡Œé¢éƒ½æ˜¯é“¾æ¥ã€‚å‘½åè§„èŒƒï¼š
	- é¦–å­—æ¯æ˜¯Sè¡¨ç¤ºå¯åŠ¨ï¼Œæ˜¯Kè¡¨ç¤ºä¸å¯åŠ¨ã€‚
	- æ¥ç€æ˜¯æ•°å­—ï¼Œæ˜¯å¯åŠ¨é¡ºåºã€‚
	- ç„¶åæ˜¯ç¨‹åºåï¼Œå’Œé“¾æ¥æ˜¯ä¸€æ ·çš„ã€‚
å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶åï¼Œç¡®å®šæ˜¯å¦å¼€æœºå¯åŠ¨ã€‚
ä½†æ˜¯ç›´æ¥æ”¹æ–‡ä»¶åå¤ªéº»çƒ¦ï¼Œæ›´æ–¹ä¾¿çš„æ˜¯ä½¿ç”¨chkconfigå‘½ä»¤ï¼š
	chkconfig æœåŠ¡å [on|off]
	æ¯”å¦‚ï¼š
	chkconfig cups on  #æ–‡ä»¶æ‰“å°å…±äº«æœåŠ¡
	chkconfig cups off
	chkconfig --list

åœ¨ubuntu10.04ä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨chkconfigæ¥è¿›è¡Œç®¡ç†ï¼Œè€Œåœ¨ä¹‹åçš„ç‰ˆæœ¬å°±æ²¡æœ‰äº†ï¼Œå¦‚æœæƒ³ç»§ç»­ä½¿ç”¨chkconfigå‘½ä»¤ï¼Œåªå¥½è‡ªå·±apt-get installä¸‹äº†ã€‚
	$ sudo apt-get install chkconfig  
åœ¨è¿™é‡Œæˆ‘ç»™å¤§å®¶ä»‹ç»å¦ä¸¤ä¸ªå‘½ä»¤æ¥é…ç½®ubuntuçš„å¯åŠ¨æœåŠ¡ï¼Œsysv-rc-confå’Œupdate-rc.d

3.
é™¤äº†å¸¸é©»è¿è¡Œçš„ç³»ç»Ÿserviceä¹‹å¤–ï¼Œè¿˜æœ‰éƒ¨åˆ†æœåŠ¡æ˜¯ç”±xinetdè¿›è¡Œæ§åˆ¶çš„ã€‚
xinetdæ§åˆ¶é‚£äº›ä¸ä¼šå¸¸é©»çš„ã€åŠŸèƒ½è¾ƒä¸ºç®€å•çš„æœåŠ¡ã€‚
xinetdæœ¬èº«æ˜¯ä¸€ä¸ªserviceã€‚
xinetdå¤ªå¤è€äº†ï¼Œç°åœ¨å·²ç»æ…¢æ…¢æ·¡å‡ºäº†ã€‚




========================================
DNSæœåŠ¡åŠåŸŸåç³»ç»Ÿæ¶æ„
----------------------------------------
1.
IPåœ°å€å¾€å¾€éš¾ä»¥è®°å¿†ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨åŸŸåè¿›è¡Œç®¡ç†ã€‚

2.
DNSå®¢æˆ·ç«¯è§£ææ–¹æ³•
	æ–‡ä»¶ï¼ˆ/etc/hostsã€/etc/networksï¼‰
	DNSæœåŠ¡å™¨ï¼ˆå®šä¹‰åœ¨ /etc/resolve.confï¼‰
	NISï¼ˆç”¨çš„å°‘ï¼ŒåŸºæœ¬è¢«æ·˜æ±°ï¼‰
å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶/etc/nsswitch.confæ§åˆ¶æŸ¥è¯¢é¡ºåºã€‚
	hosts:files dns 
	
3.	
DNSä¸“ç”¨æŸ¥è¯¢å‘½ä»¤

hostå‘½ä»¤ç”¨äºDNSæŸ¥è¯¢
$ host 163.com
163.com has address 123.58.180.8
163.com has address 123.58.180.7
163.com mail is handled by 10 163mx01.mxmail.netease.com.
163.com mail is handled by 50 163mx00.mxmail.netease.com.
163.com mail is handled by 10 163mx03.mxmail.netease.com.
163.com mail is handled by 10 163mx02.mxmail.netease.com.

digå‘½ä»¤è·å–æ›´è¯¦ç»†çš„dnsä¿¡æ¯ï¼š
$ dig tool.biomooc.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> tool.biomooc.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 12567
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;tool.biomooc.com.	IN	A

;; ANSWER SECTION:
tool.biomooc.com.	600	IN	CNAME	w39.en.tm.
w39.en.tm.	600	IN	A	103.231.13.94

;; Query time: 152 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Sun Aug 14 14:35:09 CST 2016
;; MSG SIZE rcvd: 73

è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ä¸ä¼šä½¿ç”¨/etc/nsswitch.confçš„é…ç½®ï¼Œåªä¼šé€šè¿‡/etc/resolv.confè¿›è¡ŒdnsæŸ¥è¯¢ã€‚

4.
dnsåŸŸåæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ ¹æ®åŸŸåä»å³å‘å·¦æŸ¥è¯¢ï¼ŒåŸŸåæ¯ä¸€çº§ç”±ç‹¬ç«‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ã€‚
åŸŸåæœ€åä¸€ä½è¿˜æœ‰ä¸ªç‚¹å·ï¼ŒæŒ‡çš„æ˜¯æ ¹æœåŠ¡å™¨ï¼Œä¸€èˆ¬çœç•¥ã€‚

ä½¿ç”¨ $ dig +trace åŸŸå è·å¾—æ›´è¯¦ç»†çš„åŸŸåè¿½è¸ªæµç¨‹ã€‚


$ dig +trace tool.biomooc.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> +trace tool.biomooc.com
;; global options: +cmd
.			86400	IN	NS	a.root-servers.net.
.			86400	IN	NS	b.root-servers.net.
.			86400	IN	NS	c.root-servers.net.
.			86400	IN	NS	d.root-servers.net.
.			86400	IN	NS	e.root-servers.net.
.			86400	IN	NS	f.root-servers.net.
.			86400	IN	NS	g.root-servers.net.
.			86400	IN	NS	h.root-servers.net.
.			86400	IN	NS	i.root-servers.net.
.			86400	IN	NS	j.root-servers.net.
.			86400	IN	NS	k.root-servers.net.
.			86400	IN	NS	l.root-servers.net.
.			86400	IN	NS	m.root-servers.net.
.			86400	IN	RRSIG	NS 8 0 518400 20160823050000 20160813040000 46551 . EZZnj84yvOUKWIqVBGk1ecaAm6hQ6s0txTkSGe/dAKpp0ZiVhEjRpRqv k4qwJ6Rz3sHlQa1mh7S3VZXYeZlxTRNyu+Su6fjfmEIoktroaYqi5yGs T29a7JZiPDO4HoQV6zUAssriISIGA/MX5AAsN1u+qSbFM6h3xRccUUhB nHM=
;; Received 927 bytes from 127.0.1.1#53(127.0.1.1) in 2 ms

com.			172800	IN	NS	a.gtld-servers.net.
com.			172800	IN	NS	b.gtld-servers.net.
com.			172800	IN	NS	c.gtld-servers.net.
com.			172800	IN	NS	d.gtld-servers.net.
com.			172800	IN	NS	e.gtld-servers.net.
com.			172800	IN	NS	f.gtld-servers.net.
com.			172800	IN	NS	g.gtld-servers.net.
com.			172800	IN	NS	h.gtld-servers.net.
com.			172800	IN	NS	i.gtld-servers.net.
com.			172800	IN	NS	j.gtld-servers.net.
com.			172800	IN	NS	k.gtld-servers.net.
com.			172800	IN	NS	l.gtld-servers.net.
com.			172800	IN	NS	m.gtld-servers.net.
com.			86400	IN	DS	30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766
com.			86400	IN	RRSIG	DS 8 1 86400 20160824050000 20160814040000 46551 . Oh8qMtS8xTpWJnOICFpnQAwAUtiEEkDcMvZ3k0PxlGIdWHusOjHfn26R Li8lEIWUF/kBYeIyF03a8JMcwA/9O03BnaQYUmTvFGUFz1bcr6cjf63t a2RuVqKNYuBBafHW2DCXltnEJnK1a3BIamkkMG6sQ/0lWHpPpBSeHE+u uGI=
;; Received 740 bytes from 192.58.128.30#53(j.root-servers.net) in 122 ms

biomooc.com.		172800	IN	NS	dns9.hichina.com.
biomooc.com.		172800	IN	NS	dns10.hichina.com.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20160818045655 20160811034655 27452 com. Rrrm+OShYYnljJ2KF6wqUFtdG8V58fnX/gs/rvF/TSktkGbQ0PSbEOej mgmtmBVIykd+wR9UePlwFNIvA/WjSjgNX+FCMC8lB66Q4pGAZgqwsgxK ZtCrJXbS8vdBwHc1qUuTBo0iDfkcba/UTnnajE/KZlrxuS4llZ1KDWOb b08=
230945AV9C19LKS36UGG5LDOKH0A1U4H.com. 86400 IN NSEC3 1 1 0 - 230C435M65C5MMK36130U5G6T5D7RCQM NS DS RRSIG
230945AV9C19LKS36UGG5LDOKH0A1U4H.com. 86400 IN RRSIG NSEC3 8 2 86400 20160819051104 20160812040104 27452 com. gwdr5VpFZF1jjo03FwYkdKizMRJXrZOWrh3qQ64UHK3FWbqneFcglnW2 3Gv7TQirM4s/2ibWaMO+5qlY/h7YG+JF1/3DBPf4B5f0wLrutj6+xBPq 1jiwNuFZdolb/KTwjqhFzQvaVhCDOEJSALa715crOO8WSZ04CsxX9JRf dgQ=
;; Received 673 bytes from 192.42.93.30#53(g.gtld-servers.net) in 213 ms

tool.biomooc.com.	600	IN	CNAME	w39.en.tm.
;; Received 68 bytes from 140.205.228.13#53(dns9.hichina.com) in 46 ms

å…ˆæŸ¥è¯¢., ç„¶åæ˜¯.com.ï¼Œæ¥ç€æ˜¯ biomooc.com.ï¼Œæœ€åæ˜¯ tool.biomooc.com.


5.
DNSæŸ¥è¯¢æ–¹å¼ï¼š
1ï¼‰è¿­ä»£æŸ¥è¯¢ iterative query; 
2ï¼‰é€’å½’æŸ¥è¯¢ recursive queryï¼›

å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæ˜¯åŒæ—¶ä½¿ç”¨çš„ã€‚

6.
DNSæœåŠ¡å™¨ä¸Šä¿å­˜çš„ä¿¡æ¯
RRï¼Œresource recordï¼Œé™¤äº†åŸŸååˆ°IPä¿¡æ¯ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ä¿¡æ¯ã€‚



å¸¸è§æ ‡å‡†èµ„æºè®°å½•
	SOA(Start Of Authority)
	èµ·å§‹æˆæƒè®°å½•è¡¨ç¤ºä¸€ä¸ªæˆæƒåŒºçš„å¼€å§‹

	A (Address)
	å°†ä¸»æœºåè½¬æ¢ä¸ºåœ°å€ã€‚è¿™ä¸ªå­—æ®µä¿å­˜ä»¥ç‚¹åˆ†éš”çš„åè¿›åˆ¶å½¢å¼çš„IPåœ°å€ã€‚ä»»ä½•ç»™å®šçš„ä¸»æœºéƒ½åªèƒ½æœ‰ä¸€ä¸ªAè®°å½•ï¼Œå› ä¸ºè¿™ä¸ªè®°å½•è¢«è®¤ä¸ºæ˜¯æˆæƒä¿¡æ¯ã€‚è¿™ä¸ªä¸»æœºçš„ä»»ä½•é™„åŠ åœ°å€åæˆ–åœ°å€æ˜ å°„å¿…é¡»ç”¨CNAMEç±»å‹ç»™å‡º

	CNAME (Canonical NAME)
	ç»™å®šä¸€ä¸ªä¸»æœºçš„åˆ«åï¼Œä¸»æœºçš„åˆ«åè®°å½•æ˜¯åœ¨è¿™ä¸ªä¸»æœºçš„Aè®°å½•ä¸­æŒ‡å®šçš„

	MX (Mail eXchanger)
	å»ºç«‹é‚®ä»¶äº¤æ¢å™¨è®°å½•ã€‚MXè®°å½•å‘Šè¯‰é‚®ä»¶ä¼ é€è¿›ç¨‹æŠŠé‚®ä»¶é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»ŸçŸ¥é“å¦‚ä½•å°†å®ƒé€’é€åˆ°å®ƒçš„æœ€ç»ˆç›®çš„åœ°

	NS (Name Server)
	æ ‡è¯†ä¸€ä¸ªåŸŸçš„åŸŸåæœåŠ¡å™¨ã€‚NSèµ„æºè®°å½•çš„æ•°æ®å­—æ®µåŒ…æ‹¬è¿™ä¸ªåŸŸåæœåŠ¡å™¨çš„DNSåã€‚æˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šè¿™ä¸ªåå­—åå­—æœåŠ¡å™¨çš„åœ°å€ä¸ä¸»æœºåç›¸åŒ¹é…çš„Aè®°å½•

	PTR (domain name PoinTeR)
	å°†åœ°å€å˜æ¢æˆä¸»æœºåã€‚ä¸»æœºåå¿…é¡»æ˜¯è§„èŒƒä¸»æœºå






èµ„æºè®°å½•ï¼ˆRRï¼Œresource recordï¼‰å¸¸ç”¨å±æ€§æœ‰ï¼š
	- NAME åç§°
	- CLASS ç±»åˆ«
	- TYPE ç±»å‹
	- RDATA æ•°æ®
å¦‚ï¼š
	NAME 	CLASS 	TYPE 	RDATA
	www 	IN	A 	192.168.1.1 
	mail	IN	A 	192.168.1.1 
	server1	IN	CNAME 	www 
			IN 	MX 10 mail.xxxx.net.
cnameæ˜¯åˆ«åï¼Œè¡¨æ˜å‰åæ˜¯ä¸€æ ·çš„ã€‚

Type	æ„ä¹‰
A 	IPv4åœ°å€
AAAA	IPv6åœ°å€
MX 	é‚®ä»¶è®°å½•
CNAME 	åˆ«å
PTR 	æŒ‡é’ˆï¼ˆé€†å‘è§£æï¼‰
SRV		æœåŠ¡èµ„æº


7.
DNSæœåŠ¡å™¨ç±»å‹ï¼Œä¸€èˆ¬æœ‰ä¸‰ç§
1ï¼‰Pramary DNS Server(Master)
	ä¸€ä¸ªåŸŸçš„ä¸»æœåŠ¡å™¨ä¿å­˜è¯¥åŸŸçš„zoneé…ç½®æ–‡ä»¶ï¼Œè¯¥åŸŸæ‰€æœ‰çš„é…ç½®ã€æ›´æ”¹éƒ½åœ¨è¯¥æœåŠ¡å™¨ä¸Šè¿›è¡Œã€‚

2ï¼‰Secondary DNS Server(Slave)
	ä»æœåŠ¡å™¨ä¸€èˆ¬ä½œä¸ºå†—ä½™è´Ÿè½½ä½¿ç”¨ï¼Œä¸€ä¸ªåŸŸçš„ä»æœåŠ¡å™¨ä»è¯¥åŸŸçš„ä¸»æœåŠ¡å™¨ä¸ŠæŠ“å–zoneé…ç½®æ–‡ä»¶ï¼Œä»æœåŠ¡å™¨ä¸è¿›è¡Œä¿¡æ¯ä¿®æ”¹ï¼Œæ‰€æœ‰çš„ä¿®æ”¹ä¸ä¸»æœåŠ¡å™¨åŒæ­¥ã€‚

3ï¼‰Caching only Server
	DNSç¼“å­˜æœåŠ¡å™¨ä¸å­˜åœ¨ä»»ä½•zoneæ–‡ä»¶ï¼Œä»…ä»…ä¾é ç¼“å­˜ä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œé€šå¸¸ç”¨äºè´Ÿè½½å‡è¡¡åŠåŠ é€Ÿè®¿é—®ã€‚ä¸€èˆ¬å±€åŸŸç½‘è¦é…ç½®ä¸€å°ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ä»¥å¯¹æ•´ä¸ªå±€åŸŸç½‘åŠ é€Ÿã€‚
	
8.
zoneæ–‡ä»¶

åœ¨dnsæœåŠ¡å™¨ä¸­ï¼Œä¸€èˆ¬ä¸€ä¸ªåŸŸé€šè¿‡ä¸€ä¸ªzoneæ–‡ä»¶ä¿å­˜è¯¥åŸŸçš„ç›¸å…³ä¿¡æ¯ã€‚
zoneæ–‡ä»¶çš„æ ¼å¼æ˜¯æ ‡å‡†åŒ–çš„ã€‚ä¸€ä¸ªå…¸å‹çš„zoneé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ã€‚

STTL	ID
@	IN SOA @ RNAME.iNVALID.(
		0 	;serial #åºåˆ—å·ï¼Œæ¯æ¬¡ä¿®æ”¹å¢åŠ 1
		1D 	;refresh #åˆ·æ–°æ¬¡æ•°1å¤©
		1H	;retry
		1W	;expire
		JH); minimum
		NS @
		MX 10 mail.xxxx.net.
	www IN A 192.168.1.100 
	mail IN A 192.168.1.200 
	
	
9.
digå‘½ä»¤çš„é«˜çº§æŸ¥è¯¢
1ï¼‰
$ dig -t MX gmail.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> -t MX gmail.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 29669
;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;gmail.com.			IN	MX

;; ANSWER SECTION:
gmail.com.		3600	IN	MX	40 alt4.gmail-smtp-in.l.google.com.
gmail.com.		3600	IN	MX	30 alt3.gmail-smtp-in.l.google.com.
gmail.com.		3600	IN	MX	5 gmail-smtp-in.l.google.com.
gmail.com.		3600	IN	MX	10 alt1.gmail-smtp-in.l.google.com.
gmail.com.		3600	IN	MX	20 alt2.gmail-smtp-in.l.google.com.

;; Query time: 95 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Sun Aug 14 15:13:12 CST 2016
;; MSG SIZE  rcvd: 150

å‘ç°gmailçš„é‚®ä»¶æœåŠ¡å™¨è¿˜æ˜¯æŒºå¤šçš„ã€‚MXåé¢çš„æ•°å­—å¼ä¼˜å…ˆçº§ã€‚




$ dig -t cname tool.biomooc.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> -t cname tool.biomooc.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 19822
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4000
;; QUESTION SECTION:
;tool.biomooc.com.		IN	CNAME

;; ANSWER SECTION:
tool.biomooc.com.	600	IN	CNAME	w39.en.tm.

;; ADDITIONAL SECTION:
w39.en.tm.		600	IN	A	103.231.13.94

;; Query time: 105 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Sun Aug 14 15:15:06 CST 2016
;; MSG SIZE  rcvd: 84

2ï¼‰é€†å‘è§£æï¼Œå°±æ˜¯ä»ipåœ°å€åˆ°åŸŸåçš„è§£æï¼š
$ dig -x tool.dawneve.cc 

ä¸€èˆ¬ä¸éœ€è¦ã€‚


3ï¼‰æŸ¥è¯¢soaä¿¡æ¯ï¼Œå°±æ˜¯æŸ¥è¯¢zoneæ–‡ä»¶ä¸­çš„soaä¿¡æ¯

$ dig -t soa baidu.com

; <<>> DiG 9.10.3-P4-Ubuntu <<>> -t soa baidu.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 8496
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4000
;; QUESTION SECTION:
;baidu.com.			IN	SOA

;; ANSWER SECTION:
baidu.com.		7200	IN	SOA	dns.baidu.com. sa.baidu.com. 2012132640 300 300 2592000 7200

;; ADDITIONAL SECTION:
dns.baidu.com.		28205	IN	A	202.108.22.220

;; Query time: 15 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Sun Aug 14 15:26:24 CST 2016
;; MSG SIZE  rcvd: 97



	
========================================
DNSæœåŠ¡å™¨åŸºç¡€åŠåŸŸä¸»æœåŠ¡å™¨é…ç½®
----------------------------------------
1.
BIND (Berkeley Internet Name Domain)æ˜¯Domain Name System (DNS) åè®®çš„ä¸€ä¸ªå®ç°ï¼Œæä¾›äº†DNSä¸»è¦åŠŸèƒ½çš„å¼€æ”¾å®ç°ï¼ŒåŒ…æ‹¬
	åŸŸåæœåŠ¡å™¨ (named)
	DNSè§£æåº“å‡½æ•°
	DNSæœåŠ¡å™¨è¿è¡Œè°ƒè¯•æ‰€ç”¨çš„å·¥å…·
æ˜¯ä¸€æ¬¾å¼€æ”¾æºç çš„DNSæœåŠ¡å™¨è½¯ä»¶ï¼Œç”±ç¾å›½åŠ å·å¤§å­¦Berkeleyåˆ†æ ¡å¼€å‘å’Œç»´æŠ¤çš„ï¼Œ

æŒ‰ç…§ISCçš„è°ƒæŸ¥æŠ¥å‘Šï¼ŒBINDæ˜¯ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¤šæœ€å¹¿æ³›çš„åŸŸåæœåŠ¡ç³»ç»Ÿã€‚ä¸è®ºä½ çš„é‚®ä»¶æœåŠ¡å™¨ï¼ŒWEBæœåŠ¡å™¨æˆ–è€…å…¶ä»–çš„serviceså¦‚ä½•çš„å®‰å…¨å¯é ï¼ŒDNSçš„æ•…éšœä¼šç»™ä½ å¸¦æ¥ç”¨æˆ·æ ¹æœ¬æ— æ³•è®¿é—®è¿™äº›æœåŠ¡ã€‚

BINDï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´çš„namedï¼Œç”±äºå¤šæ•°ç½‘ç»œåº”ç”¨ç¨‹åºä½¿ç”¨å…¶åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šBINDçš„å¼±ç‚¹åŠæ—¶è¢«å‘ç°ã€‚ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªç‰ˆæœ¬ï¼š

v4
1998å¹´å¤šæ•°UNIXæ†ç»‘çš„æ˜¯BIND4ï¼Œå·²ç»è¢«å¤šæ•°å‚å•†æŠ›å¼ƒäº†ï¼Œé™¤äº†OpenBSDè¿˜åœ¨ä½¿ç”¨ã€‚OpenBSDæ ¸å¿ƒäººä¸ºBIND8è¿‡äºå¤æ‚å’Œä¸å®‰å…¨ï¼Œæ‰€ä»¥ç»§ç»­ä½¿ç”¨BIND4ã€‚è¿™æ ·ä¸€æ¥BIND8/9çš„å¾ˆå¤šä¼˜ç‚¹éƒ½ä¸åŒ…æ‹¬åœ¨v4ä¸­ã€‚

v8
å°±æ˜¯å¦‚ä»Šä½¿ç”¨æœ€å¤šæœ€å¹¿çš„ç‰ˆæœ¬ï¼Œå…¶è¯¦ç»†å†…å®¹å¯ä»¥å‚é˜… BIND 8+ åŸŸåæœåŠ¡å™¨å®‰å…¨å¢å¼º

v9
æœ€æ–°ç‰ˆæœ¬çš„BINDï¼Œå…¨éƒ¨é‡æ–°å†™è¿‡ï¼Œå…è´¹ï¼ˆä½†æ˜¯ç”±å•†ä¸šå…¬å¸èµ„åŠ©ï¼‰ï¼Œä¹Ÿæ·»åŠ äº†è®¸å¤šæ–°çš„åŠŸèƒ½ï¼ˆä½†æ˜¯å®‰å…¨ä¸Šä¹Ÿå¯èƒ½æœ‰æ›´å¤šçš„é—®é¢˜ï¼‰ã€‚BIND9åœ¨2000å¹´åæœˆä»½æ¨å‡ºï¼Œç°åœ¨ç¨³å®šç‰ˆæœ¬æ˜¯9.3.2ã€‚


bindï¼ˆBerkeley Internet Name Domainï¼‰æ˜¯ç°ä»Šä½¿ç”¨æœ€å¹¿æ³›çš„dnsæœåŠ¡å™¨ã€‚
bindæœåŠ¡çš„åç§°ç§°ä¹‹ä¸ºnamedã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…bindã€‚
	$ yum install -y bind bind-chroot bind-utils
	å¯¹äºubuntuï¼š
	$ sudo apt-get install bind9 bind9utils bind9-doc
DNSé»˜è®¤ä½¿ç”¨UDPã€TCPåè®®ï¼Œä½¿ç”¨ç«¯å£ä¸º53ï¼ˆdomainï¼‰ã€953ï¼ˆmdcï¼Œè¿œç¨‹ï¼‰

2.
BINDé…ç½®æ–‡ä»¶ä¿å­˜åœ¨ä¸¤ä¸ªä½ç½®ï¼š
	/etc/named.conf 	- BINDæœåŠ¡ä¸»é…ç½®æ–‡ä»¶
	/var/named/ 	- zoneæ–‡ä»¶ 

å¦‚æœå®‰è£…äº†bind-chrootï¼ŒBINDä¼šè¢«å°è£…åˆ°ä¸€ä¸ªä¼ªæ ¹ç›®å½•å†…ï¼Œé…ç½®æ–‡ä»¶çš„ä½ç½®å˜ä¸ºï¼š
	/var/named/chroot/etc/named.conf
	/var/named/chroot/var/named/ 
chrootæ˜¯é€šè¿‡å°†ç›¸å…³æ–‡ä»¶å°è£…åœ¨ä¸€ä¸ªä¼ªæ ¹ç›®å½•å†…ï¼Œè¾¾åˆ°å®‰å…¨é˜²æŠ¤çš„ç›®çš„ï¼Œä¸€æ—¦è¯¥ç¨‹åºè¢«æ”»ç ´ï¼Œå°†åªèƒ½è®¿é—®ä¼ªæ ¹ç›®å½•çš„å†…å®¹ï¼Œè€Œä¸æ˜¯çœŸæ˜¯çš„æ ¹ç›®å½•ã€‚
	
	
	
3.
åŸŸä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰æ˜¯è¿™ä¸ªåŸŸçš„ä¿¡æ¯çš„æƒå¨æœåŠ¡å™¨ï¼Œæ‰€æœ‰è¿™ä¸ªåŸŸçš„ä¿¡æ¯éƒ½æ˜¯ç”±åŸŸçš„ä¸»æœåŠ¡å™¨æ§åˆ¶ï¼Œé…ç½®ä¸€ä¸ªåŸŸçš„ä¸»æœåŠ¡å™¨éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

å¸®åŠ©æ–‡æ¡£æä¾›äº†ä¸€ä»½æ ·æœ¬ï¼Œåœ¨ /usr/share/doc/bind-9.8.2/sample/ä¸‹é¢ã€‚


1ï¼‰åœ¨bindçš„ä¸»é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¯¥åŸŸçš„å®šä¹‰
	/var/named/chroot/etc/named.conf 
	options{
		directory	"/var/named";
		listen-on port 53	{127.0.0.1;};
		listen-on-v6 port 53	{::1;};
		
	};
	zone "dawneve.com"{
		type master;
		file "dawneve.com.zone";
	};
2ï¼‰åœ¨/var/named/chroot/var/namedä¸­åˆ›å»ºè¯¥åŸŸçš„zoneæ–‡ä»¶ï¼Œ
	/var/named/dawneve.com.zoneï¼Œæ–‡ä»¶å¾ˆå¤æ‚ï¼Œä¸€èˆ¬ä½¿ç”¨named.localhostä½œä¸ºæ¨¡æ¿ã€‚
	éœ€è¦rootç”¨æˆ·æ“ä½œè¿™äº›æ–‡ä»¶ã€‚
	
# cd /var/named/
# cp named.localhost dawneve.com.zone 
# vim dawneve.com.zone 

$TTL    604800
@       IN      SOA     localhost. root.localhost. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

	NS	@ 
	            A       127.0.0.1       ; delete this line
	            AAAA    ::1             ; delete this line
		IN MX 10 mail.dawneve.com.
www 	IN 	A 	192.168.1.100 
mail 	IN 	A 	192.168.1.200
tool 	IN 	A 	192.168.1.222

ä¸€å®šè¦æ³¨æ„ï¼šmail.dawneve.com. æœ€åè¿˜æœ‰ä¸€ä¸ªç‚¹å·ä¸èƒ½çœç•¥ï¼


3ï¼‰ç¼–è¾‘zoneæ–‡ä»¶ï¼Œæ·»åŠ éœ€è¦çš„ä¿¡æ¯
4ï¼‰å¯åŠ¨bindæœåŠ¡æˆ–ä½¿bindåˆ·æ–°é…ç½®
	(1)å¯åŠ¨bindæœåŠ¡æˆ–åˆ·æ–°é…ç½®ï¼š
	service named start 


5ï¼‰ä½¿ç”¨hostæˆ–digå‘½ä»¤æ£€æµ‹åŸŸä¿¡æ¯æ˜¯å¦æ­£å¸¸ã€‚

ä¸€èˆ¬çš„é”™è¯¯ï¼Œè¦ä¹ˆæ˜¯è¯­æ³•é”™è¯¯ã€‚è¦ä¹ˆæ˜¯æƒé™é”™è¯¯ã€‚è¦ä¿è¯éƒ½æœ‰è¯»æƒé™ï¼

è¯­æ³•æ£€æŸ¥ï¼š
æ£€æŸ¥ä¸»é…ç½®æ–‡ä»¶ï¼š
$ named-checkconf /etc/named.conf 
æ£€æŸ¥zoneé…ç½®æ–‡ä»¶ï¼š
$ named-checkzone dawneve.com /var/named/dawneve.com.zone 

ä¾‹å¦‚ï¼š
$ named-checkconf /etc/named.conf 
wangjl@Ubuntu1604:/var/named$ named-checkzone dawneve.com dawneve.com.zone
zone dawneve.com/IN: loaded serial 2
OK




4.
1ï¼‰å¯åŠ¨bindæœåŠ¡æˆ–è€…åˆ·æ–°é…ç½®ï¼š
	# service named start 
	# service named reload
2)å°†æœ¬æœºçš„dnsé…ç½®æŒ‡å‘æœ¬æœº
/etc/resolv.conf 
nameserver 127.0.0.1 
3)ä½¿ç”¨hostæˆ–è€…digéªŒè¯dnsé…ç½®ï¼š
host www.dawneve.com 
dig www.dawneve.com 




========================================
BINDé…ç½®æ’é”™æ–¹æ³•
----------------------------------------
1.
æ˜¯å¦å¯åŠ¨æœåŠ¡
# service named status 

2.
53å·ç«¯å£æ˜¯DNSæœåŠ¡ä½¿ç”¨çš„ï¼Œä½ å¯åŠ¨äº†DNSæœåŠ¡ï¼Œè‡ªç„¶å°±ä¼šç›‘å¬53å·ç«¯å£ã€‚
æŸ¥çœ‹53ç«¯å£å·æ˜¯å¦å¯åŠ¨ï¼š
$ netstat -utln
$ netstat -utln | grep 53 #æŸ¥çœ‹53ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Ÿ

3.
é˜²ç«å¢™æ˜¯å¦æ‰“å¼€äº†53ç«¯å£ï¼š
å¯ä»¥å…³æ‰é˜²ç«å¢™ã€‚å¦‚æœæƒ³æ‰“å¼€é˜²ç«å¢™ï¼Œä»…æ‰“å¼€53ç«¯å£çš„è¯ï¼Œè¿™æ ·ï¼š
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT

4.
æ£€æŸ¥ /var/log/messages çš„å†…å®¹ï¼Œæ£€æŸ¥é”™è¯¯æç¤ºï¼š 
# tail -n 15 /var/log/messages 
# tail -n 15 /var/log/messages | grep named 


5.
æ£€æŸ¥æ–‡ä»¶æƒé™ï¼šæ³¨æ„æ–‡ä»¶æ‰€å±ç»„éƒ½è¦æ˜¯namedï¼Œå¦åˆ™æŠ¥é”™ã€‚
	- æ–‡ä»¶åŒ…æ‹¬ä¸»é…ç½®æ–‡ä»¶ /etc/named.conf ,åŸŸé…ç½®æ–‡ä»¶ /var/named/xx.com.zone ç­‰ã€‚
	- æ‰€ä»¥ä½¿ç”¨ls -læ£€æŸ¥æ‰€å±ç»„ã€‚
	- ä½¿ç”¨cp aa.com.zone bb.com.zone -a #åŠ ä¸Š-aå‚æ•°èƒ½å¤åˆ¶å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬æƒé™ã€‚

	
6.å®¢æˆ·æœºæ˜¯å¦ä½¿ç”¨äº†é»˜è®¤DNSæœåŠ¡å™¨ï¼Ÿ
	> ipconfig /all #windowsæŸ¥çœ‹dnsæœåŠ¡å™¨
	å¦‚æœä½¿ç”¨äº†ç‰¹å®šDNSï¼Œè¯·ä¿®æ”¹ä¸ºé»˜è®¤DNSã€‚

7.windowä¸‹æ˜¯å¦æ¸…æ¥šäº†dnsç¼“å­˜ï¼Ÿ
	> ipconfig /flushdns #æ¸…ç†dnsç¼“å­˜

	
========================================
BINDä»æœåŠ¡å™¨åŠç¼“å­˜æœåŠ¡å™¨é…ç½®ï¼ˆä»æœåŠ¡å™¨åŠç¼“å­˜æœåŠ¡å™¨ï¼‰
----------------------------------------

1.åŸŸä»æœåŠ¡å™¨
ä¸€ä¸ªåŸŸçš„ä»æœåŠ¡å™¨ï¼ˆslaveï¼‰é€šå¸¸æ˜¯ä¸ºäº†å¤‡ä»½åŠè´Ÿè½½å‡è¡¡ä½¿ç”¨ï¼Œæ‰€æœ‰è¿™ä¸ªåŸŸçš„ä¿¡æ¯éƒ½æ˜¯ç”±åŸŸçš„ä¸»æœåŠ¡å™¨æ§åˆ¶ï¼ŒåŸŸslaveæœåŠ¡å™¨å¯åŠ¨æ—¶ä¼šä»åŸŸçš„ä¸»æœåŠ¡å™¨masterä¸ŠæŠ“å–æŒ‡å®šåŸŸçš„zoneé…ç½®æ–‡ä»¶ï¼ŒåŸŸslaveæœåŠ¡å™¨çš„é…ç½®å¦‚ä¸‹ï¼š
1ï¼‰åœ¨bindçš„ä¸»é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¯¥åŸŸçš„å®šä¹‰ï¼›
2ï¼‰å¯åŠ¨bindæœåŠ¡æˆ–ä½¿bindåˆ·æ–°é…ç½®ï¼›
3ï¼‰æŸ¥çœ‹åŸŸçš„zoneæ–‡ä»¶æ˜¯å¦æ­£å¸¸æŠ“å–åˆ°/var/named/slavesç›®å½•ä¸­ï¼›
4ï¼‰ä½¿ç”¨hostæˆ–digå‘½ä»¤æ£€æµ‹åŸŸä¿¡æ¯æ˜¯å¦æ­£å¸¸ã€‚












========================================
ç³»ç»Ÿèµ„æºç›‘æ§ - centOS7 ç³»ç»Ÿèµ„æºç›‘æ§
----------------------------------------
1.
$ sudo apt install glances 

$ glances #å°†æ¶ˆè€—æœ€é«˜ç³»ç»Ÿèµ„æºçš„è¿›ç¨‹ç”¨çº¢è‰²æ ‡å‡º


(2)åŒæ—¶è¿˜å¯ä»¥è¿œç¨‹ç›‘æ§ï¼š
åœ¨æœåŠ¡å™¨ç«¯å¯åŠ¨
$ glances -s -B 192.168.1.120

$ glances -s -p 9000
Glances XML-RPC server is running on 0.0.0.0:9000

éœ€è¦å®¢æˆ·ç«¯è¿æ¥ï¼Ÿ


(3)åŒæ—¶è¿˜å¯ä»¥åœ¨webé¡µé¢ç›‘æ§ï¼š//todo
$ glances --export-graph --path-graph ./



========================================
|-- å†…å­˜
----------------------------------------
æ€»ä½“æ˜¯å…ˆç›‘æ§ä¸Šï¼Œç„¶åå†å¯è§†åŒ–ç›‘æ§ã€‚


1.æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
$ free -m
              total        used        free      shared  buff/cache   available
Mem:          31848       20601        6958           9        4288       10777
Swap:          2047         452        1595



2.è¯¦ç»†åˆ—å‡ºçš„è¿›ç¨‹æƒ…å†µï¼Œé‡ç‚¹å…³æ³¨ç¬¬10åˆ—å†…å­˜ä½¿ç”¨å æ¯”ï¼š
$ top
top - 15:30:58 up 63 days, 23:30, 12 users,  load average: 0.08, 0.22, 0.16
Tasks: 306 total,   1 running, 218 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.6 us,  0.9 sy,  0.0 ni, 98.4 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 32613176 total,  7125644 free, 21096460 used,  4391072 buff/cache
KiB Swap:  2097148 total,  1633840 free,   463308 used. 11035752 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND         
 3785 root      20   0 1988144  11436    560 S  15.2  0.0  10472:27 teamviewerd     
  927 avahi     20   0   53316   5900      0 S   1.0  0.0 392:50.44 avahi-daemon    
 1909 root      20   0 1629228   8992   2396 S   0.3  0.0 191:19.48 docker-containe 
 6826 wangjl    20   0  570760  11588    852 S   0.3  0.0 219:11.94 python          
 9745 root      20   0       0      0      0 I   0.3  0.0   0:00.01 kworker/6:2     
 9822 root      20   0       0      0      0 I   0.3  0.0   0:00.11 kworker/8:1     
 9828 wangjl    20   0   43052   4272   3384 R   0.3  0.0   0:00.08 top             
22841 wangjl    20   0  374076  27964   6860 S   0.3  0.1   2:01.09 jupyter-noteboo 
    1 root      20   0  225848   6832   4476 S   0.0  0.0 219:02.59 systemd         
    2 root      20   0       0      0      0 S   0.0  0.0   0:02.60 kthreadd        
    4 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 kworker/0:0H    
    6 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 mm_percpu_wq
#


3.æŸ¥çœ‹æ¶ˆè€—å†…å­˜æœ€å¤šçš„å‰5ä¸ªè¿›ç¨‹ï¼š
$ ps auxw|head -1;ps auxw|sort -rn -k4|head -5
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
wangjl    2007  0.1 62.4 22636272 20380768 ?   Ssl  Oct07   5:11 /home/wangjl/anaconda3/bin/python -m ipykernel_launcher -f /run/user/1001/jupyter/kernel-xxx.json
rstudio+  3116  0.1  0.5 2064636 183256 pts/0  Ssl+ Aug08  92:00 mysqld
root     20357  0.0  0.1 166984 48536 ?        S<s  Sep12   1:37 /lib/systemd/systemd-journald
xrdp      1094  0.0  0.0  24808     0 ?        S    Aug06   0:00 /usr/sbin/xrdp
www-data  8666  0.0  0.0 390052    24 ?        S    Sep11   0:00 /usr/sbin/apache2 -k start






========================================
|-- CPU
----------------------------------------
1. 
Physical id 	#ç›¸åŒè¡¨ç¤ºä¸ºåŒä¸€ä¸ªç‰©ç†CPU
Processor 	#é€»è¾‘CPU
Cpu cores 	#CPUæ ¸æ•°ï¼Œå†…æ ¸ä¸ªæ•°
Core id 	#å†…æ ¸idå·
Siblings 	#æ¯ä¸ªç‰©ç†CPUé‡Œé¢çš„é€»è¾‘CPUä¸ªæ•°


æŸ¥çœ‹CPUå‹å·
$ cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c
12  Intel(R) Xeon(R) W-2135 CPU @ 3.70GHz

æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•°
$ cat /proc/cpuinfo | grep "physical id" | sort -u | wc -l  
1

æŸ¥çœ‹é€»è¾‘CPUä¸ªæ•°
$ cat /proc/cpuinfo | grep "processor" | wc -l
12

æŸ¥çœ‹CPUå†…æ ¸æ•°
$ cat /proc/cpuinfo | grep "cpu cores" | uniq  
cpu cores	: 6

æŸ¥çœ‹å•ä¸ªç‰©ç†CPUå°è£…çš„é€»è¾‘CPUæ•°é‡
$ cat /proc/cpuinfo | grep "siblings" | uniq  
siblings        : 12

è®¡ç®—æ˜¯å¦å¼€å¯è¶…çº¿ç¨‹
é€»è¾‘CPU > ç‰©ç†CPU x CPUæ ¸æ•° #å¼€å¯è¶…çº¿ç¨‹
é€»è¾‘CPU = ç‰©ç†CPU x CPUæ ¸æ•° #æ²¡æœ‰å¼€å¯è¶…çº¿ç¨‹æˆ–ä¸æ”¯æŒè¶…çº¿ç¨‹

æŸ¥çœ‹æ˜¯å¦è¶…çº¿ç¨‹
$ cat /proc/cpuinfo | grep -e "cpu cores"  -e "siblings" | sort | uniq
cpu cores	: 6
siblings	: 12
è¯´æ˜ï¼šå¦‚æœcpu coresæ•°é‡å’Œsiblingsæ•°é‡ä¸€è‡´ï¼Œåˆ™æ²¡æœ‰å¯ç”¨è¶…çº¿ç¨‹ï¼Œå¦åˆ™è¶…çº¿ç¨‹è¢«å¯ç”¨ã€‚


è„šæœ¬
$ cat cpu.sh   
#!/bin/bash
cpuname=$(cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c)
physical=$(cat /proc/cpuinfo | grep "physical id" | sort -u | wc -l)
processor=$(cat /proc/cpuinfo | grep "processor" | wc -l)
cpucores=$(cat /proc/cpuinfo  | grep "cpu cores" | uniq)
siblings=$(cat /proc/cpuinfo  | grep "siblings"  | uniq)

echo "* * * * * CPU Information * * * * *"
echo "ï¼ˆCPUå‹å·ï¼‰cpu name : $cpuname"
echo "ï¼ˆç‰©ç†CPUä¸ªæ•°ï¼‰physical id is : $physical"
echo "ï¼ˆé€»è¾‘CPUä¸ªæ•°ï¼‰processor is : $processor"
echo "ï¼ˆCPUå†…æ ¸æ•°ï¼‰cpu cores is : $cpucores"
echo "ï¼ˆå•ä¸ªç‰©ç†CPUçš„é€»è¾‘CPUæ•°ï¼‰siblings is : $siblings"
#

è„šæœ¬è¿è¡Œæ•ˆæœ
$ sh cpu.sh 
* * * * * CPU Information * * * * *
ï¼ˆCPUå‹å·ï¼‰cpu name :      12  Intel(R) Xeon(R) W-2135 CPU @ 3.70GHz
ï¼ˆç‰©ç†CPUä¸ªæ•°ï¼‰physical id is : 1
ï¼ˆé€»è¾‘CPUä¸ªæ•°ï¼‰processor is : 12
ï¼ˆCPUå†…æ ¸æ•°ï¼‰cpu cores is : cpu cores	: 6
ï¼ˆå•ä¸ªç‰©ç†CPUçš„é€»è¾‘CPUæ•°ï¼‰siblings is : siblings	: 12





2. vmstatæ˜¯Linuxç³»ç»Ÿç›‘æ§å·¥å…·ï¼Œä½¿ç”¨vmstatå‘½ä»¤å¯ä»¥å¾—åˆ°å…³äºè¿›ç¨‹ã€å†…å­˜ã€å†…å­˜åˆ†é¡µã€å µå¡IOã€trapsåŠCPUæ´»åŠ¨çš„ä¿¡æ¯ã€‚

$ vmstat 1
procs  -----------memory------------   --swap--   ---io---- -system-- ------cpu-----
 r  b   swpd   free   buff    cache     si   so    bi    bo   in   cs us sy id wa st
 0  0 463308 7124444 1377552 3014080    0    0    26    33    0    0  1  1 98  0  0
 0  0 463308 7124436 1377552 3014116    0    0     0     0  774 9451  1  1 98  0  0
 0  0 463308 7124436 1377552 3014116    0    0     0     0  338  697  0  0 100  0  0
 0  0 463308 7124436 1377552 3014116    0    0     0     0  649 9562  1  1 98  0  0
 0  0 463308 7124436 1377552 3014116    0    0     0     0  374  686  0  0 100  0  0

rï¼šè¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ï¼›bï¼šç­‰å¾…IOçš„è¿›ç¨‹æ•°ã€‚
swpdï¼šå·²ç”¨è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆkï¼‰ï¼›freeï¼šç©ºé—²å†…å­˜å¤§å°ï¼›buffï¼šå·²ç”¨ç¼“å†²å¤§å°ï¼›cacheï¼šå·²ç”¨ç¼“å­˜å¤§å°ã€‚
siï¼šæ¯ç§’ä»äº¤æ¢åŒºå†™å…¥å†…å­˜çš„å¤§å°ï¼ˆkb/sï¼‰ï¼›soï¼šæ¯ç§’ä»å†…å­˜å†™å…¥äº¤æ¢åˆ†åŒºçš„å¤§å°ã€‚

biï¼šæ¯ç§’è¯»å–çš„å—æ•°ï¼›boæ¯ç§’å†™å…¥çš„å—æ•°ã€‚
inï¼šæ¯ç§’ä¸­æ–­æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­ï¼›csï¼šæ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ•°ã€‚
us(user time)ï¼šç”¨æˆ·è¿›ç¨‹æ‰§è¡Œæ¶ˆè€—cpuæ—¶é—´ï¼›sy(system time)ï¼šç³»ç»Ÿè¿›ç¨‹æ‰§è¡Œæ¶ˆè€—cpuæ—¶é—´ï¼›idï¼šç©ºé—²æ—¶é—´ï¼ˆåŒ…æ‹¬IOç­‰å¾…æ—¶é—´ï¼‰ï¼›waï¼šç­‰å¾…IOæ—¶é—´ã€‚


(2) /proc/statï¼š
è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ‰€æœ‰CPUæ´»åŠ¨çš„ä¿¡æ¯ï¼Œè¯¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ã€‚å¯ä»¥åˆ©ç”¨å…¶ä¸­ä¿¡æ¯è®¡ç®—cpuçš„åˆ©ç”¨ç‡ã€‚
$ cat /proc/stat
cpu  85870228 93600 42725582 6489209034 9137121 0 421790 0 0 0
cpu0 6602769 7449 3339631 541497724 761981 0 142049 0 0 0
cpu1 6611019 7534 3375450 541922359 476956 0 11676 0 0 0
cpu2 6445912 7690 3390426 541996062 566815 0 7825 0 0 0
cpu3 6903904 4741 3354675 541637542 520768 0 5106 0 0 0
cpu4 6398322 5495 3364155 542155286 493559 0 3780 0 0 0

æ¯è¡Œæ¯ä¸ªå‚æ•°çš„æ„æ€ä¸ºï¼ˆä»¥ç¬¬ä¸€è¡Œä¸ºä¾‹ï¼Œå•ä½ï¼šjiffiesï¼Œ1jiffies=0.01ç§’ï¼‰ï¼š
userï¼ˆ6602769ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œç”¨æˆ·æ€çš„CPU1æ—¶é—´ï¼Œä¸åŒ…å« niceå€¼ä¸ºè´Ÿè¿›ç¨‹ã€‚
niceï¼ˆ7449ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ã€‚
systemï¼ˆ3339631ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œniceå€¼ä¸ºè´Ÿçš„è¿›ç¨‹æ‰€å ç”¨çš„CPUæ—¶é—´ã€‚
idleï¼ˆ541497724ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œé™¤ç¡¬ç›˜IOç­‰å¾…æ—¶é—´ä»¥å¤–å…¶å®ƒç­‰å¾…æ—¶é—´ã€‚
iowaitï¼ˆ761981ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œç¡¬ç›˜IOç­‰å¾…æ—¶é—´ã€‚
irqï¼ˆ0ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œç¡¬ä¸­æ–­æ—¶é—´ã€‚
softirqï¼ˆ142049ï¼‰ï¼šä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç´¯è®¡åˆ°å½“å‰æ—¶åˆ»ï¼Œè½¯ä¸­æ–­æ—¶é—´ã€‚
CPUæ—¶é—´=user+nice+system+idle+iowait+irq+softirqã€‚
CPUåˆ©ç”¨ç‡=(idle2-idle1)/(cpu2-cpu1)*100ã€‚


(3)ps auxï¼š
æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·å¯åŠ¨çš„è¿›ç¨‹ï¼ˆaï¼‰
æŸ¥çœ‹ç³»ç»Ÿä¸­å±äºè‡ªå·±çš„è¿›ç¨‹ï¼ˆxï¼‰
å¯åŠ¨è¿™ä¸ªè¿›ç¨‹çš„ç”¨æˆ·å’Œå¯åŠ¨æ—¶é—´ ï¼ˆuï¼‰
$ ps -aux | sort -k4nr | head -5
wangjl    2007  0.1 62.4 22636272 20380768 ?   Ssl  Oct07   5:11 /home/wangjl/anaconda3/bin/python -m ipykernel_launcher -f /run/user/1001/jupyter/kernel-xx1.json
rstudio+  3116  0.1  0.5 2064636 183256 pts/0  Ssl+ Aug08  92:01 mysqld
wangjl    6111  0.0  0.2 1244588 77036 ?       Ssl  Oct08   0:05 /home/wangjl/anaconda3/bin/python -m ipykernel_launcher -f /run/user/1001/jupyter/kernel-xx2.json
root     20357  0.0  0.1 166984 48560 ?        S<s  Sep12   1:37 /lib/systemd/systemd-journald
wangjl   22934  0.0  0.1 644688 33040 ?        Ssl  Oct04   0:14 /home/wangjl/anaconda3/bin/python -m ipykernel_launcher -f /run/user/1001/jupyter/kernel-xx3.json





========================================
|-- ç¡¬ç›˜
----------------------------------------
1.ç¡¬ç›˜æŸ¥çœ‹
$ sudo fdisk -l


$ df -lh
Filesystem      Size  Used Avail Use% Mounted on
udev             16G     0   16G   0% /dev
tmpfs           3.2G  1.8M  3.2G   1% /run
/dev/sda2       234G  214G  8.3G  97% /
/dev/sdb        3.6T  2.5T  990G  72% /data



========================================
è¿œç¨‹ç™»å½•ã€è¿œç¨‹æ¡Œé¢æœåŠ¡
----------------------------------------


========================================
|-- win10è¿œç¨‹æ¡Œé¢è¿æ¥Ubuntu18å›¾å½¢ç•Œé¢ï¼ˆxrdpæ–¹æ³•ï¼‰
----------------------------------------
1.è¿æ¥æœ¬å±€åŸŸç½‘å†…çš„å¯ä»¥
ç‰©ç†æœºæ˜¯ubuntu1804å·¥ä½œç«™ã€‚

æŸ¥çœ‹æ˜¯å¦å®‰è£…æœ‰xrdp( remote desktop protocol)
$ ps -aux | grep xrdp
root      1162  0.0  0.0  41652     4 ?        S    Jan13   0:00 /usr/sbin/xrdp-sesman
xrdp      1201  0.0  0.0  25256     4 ?        S    Jan13   0:00 /usr/sbin/xrdp

æŸ¥çœ‹ä½¿ç”¨çš„ç«¯å£å·
$ sudo netstat -lnpt | grep xrdp
tcp6       0      0 ::1:3350                :::*                    LISTEN      1162/xrdp-sesman    
tcp6       0      0 :::3389                 :::*                    LISTEN      1201/xrdp
ç¬¬å››åˆ—IPåé¢å°±æ˜¯ç«¯å£å·ï¼Œä¸€ä¸ªæ˜¯åå°æœåŠ¡3350ï¼Œä¸€ä¸ªæ˜¯ä¾›å‰å°è¿æ¥çš„ç«¯å£3389ã€‚

åœ¨win10å¼€å§‹èœå•æœç´¢ è¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œè¾“å…¥ip:portï¼Œä¸€è·¯ç¡®å®šï¼Œè¾“å…¥ubuntuç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯ç™»å½•gnomeæ¡Œé¢ã€‚

(2) å¦‚æœåˆ†è¾¨ç‡æ„Ÿè§‰å¤ªå¤§ï¼Œåˆ™å¯ä»¥è°ƒèŠ‚
åœ¨win10å¼€å§‹èœå•æœç´¢ è¿œç¨‹æ¡Œé¢è¿æ¥ï¼Œ 
ç‚¹å‡»å·¦ä¸‹è§’ æ˜¾ç¤ºé€‰é¡¹ï¼Œé€‰æ‹©é¡¶éƒ¨é€‰é¡¹å¡ æ˜¾ç¤ºï¼Œæ»‘åŠ¨æ¡é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åˆ†è¾¨ç‡ï¼Œ
å›åˆ°é€‰é¡¹å¡ å¸¸è§„ï¼Œåœ¨è®¡ç®—æœº ä¸€æ ä¸­è¾“å…¥ IP:port æ¯”å¦‚ y.biomooc.com:7000
ç‚¹å‡»åº•éƒ¨ è¿æ¥ æŒ‰é’®ã€‚
è¾“å…¥ ubuntu ç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯ç™»å½•genomeæ¡Œé¢ã€‚




2. è¿æ¥è¿œæ–¹vpså¤±è´¥

é‡è¯•äº†ä¸€æ¬¡ï¼Œå…ˆå®‰è£…gnome
sudo apt-get install ubuntu-gnome-desktop
é€‰æ‹©lightDMï¼Œå›è½¦ã€‚

sudo apt install xrdp 
sudo systemctl enable xrdp 

sudo reboot #é‡å¯ä¸è¦ç™»å½•äº†ã€‚ä½¿ç”¨win10 è¿œç¨‹ç™»å½•ã€‚
å¡«å†™IPå’Œç«¯å£å·å³å¯ã€‚





3. å¯èƒ½çœŸçš„æ˜¯å­¦æ ¡å°é”äº†3389ç«¯å£ã€‚
å¤§å±€åŸŸç½‘å†…ç›´æ¥è¿æ¥3389ä¹Ÿæ˜¯è¿ä¸ä¸Šï¼Œæ¢ä¸ªç«¯å£å°±æ­£å¸¸äº†ã€‚

ubuntu1804ä¸‹:
å®‰è£…xrdpï¼Œè§ä¸Šä¸€æ­¥ã€‚

$ sudo vim /etc/xrdp/xrdp.ini 
ä¿®æ”¹ port=3389ä¸º
port=3388

ç„¶åé‡å¯xrdpå°±å¯ä»¥äº†
$ sudo service xrdp restart

æŸ¥ip
$ ifconfig

ä½¿ç”¨win10çš„è¿œç¨‹æ¡Œé¢ï¼Œç™»å½•
10.20.12.207:3388
ä¸€è·¯ç¡®å®šï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå³å¯ç™»å½•ubuntuçš„æ¡Œé¢äº†ã€‚





ref:
https://zhuanlan.zhihu.com/p/54239071







========================================
|-- Ubuntuä¸Šå®‰è£…VNC server //todo æœªæµ‹è¯•é€šè¿‡
----------------------------------------
è½¯ä»¶ï¼š
https://wiki.debian.org/VNCviewer
http://packages.ubuntu.com/precise/gvncviewer

é…ç½®ï¼š
http://blog.itpub.net/519536/viewspace-607549/

1.å®‰è£… 
$apt-get install vnc4server

2.å¯åŠ¨
2.å¯åŠ¨VNCæœåŠ¡
ä½¿ç”¨vncserverå‘½ä»¤å¯åŠ¨VNCæœåŠ¡ï¼Œå‘½ä»¤æ ¼å¼ä¸ºâ€œvncserver :æ¡Œé¢å·â€ï¼Œå…¶ä¸­â€œæ¡Œé¢å·â€ç”¨â€œæ•°å­—â€çš„æ–¹å¼è¡¨ç¤ºï¼Œæ¯ä¸ªç”¨æˆ·è¿ä¸ªéœ€è¦å ç”¨1ä¸ªæ¡Œé¢
å¯åŠ¨ç¼–å·ä¸º1çš„æ¡Œé¢ç¤ºä¾‹å¦‚ä¸‹
$ vncserver

You will require a password to access your desktops.
Password:
Verify:
xauth:  file /home/wangjl/.Xauthority does not exist

New 'Bioinf1:2 (wangjl)' desktop is Bioinf1:2

Creating default startup script /home/wangjl/.vnc/xstartup
Starting applications specified in /home/wangjl/.vnc/xstartup
Log file is /home/wangjl/.vnc/Bioinf1:2.log 

ä»¥ä¸Šå‘½ä»¤æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œéœ€è¦è¾“å…¥å¯†ç ï¼Œè¿™ä¸ªå¯†ç è¢«åŠ å¯†ä¿å­˜åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.vncå­ç›®å½•ï¼ˆ/root/.vnc/passwdï¼‰ä¸­ï¼›åŒæ—¶åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.vncå­ç›®å½•ä¸­ä¸ºç”¨æˆ·è‡ªåŠ¨å»ºç«‹xstartupé…ç½®æ–‡ä»¶ï¼ˆ/root/.vnc/xstartupï¼‰ï¼Œåœ¨æ¯æ¬¡å¯åŠ¨VNDæœåŠ¡æ—¶ï¼Œéƒ½ä¼šè¯»å–è¯¥æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚
BTWï¼š/root/.vnc/ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªâ€œtestdb:1.pidâ€æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•ç€å¯åŠ¨VNCåå¯¹åº”åå¤©æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å·ï¼Œç”¨äºåœæ­¢VNCæœåŠ¡æ—¶å‡†ç¡®å®šä½è¿›ç¨‹å·ã€‚



3.VNCæœåŠ¡ä½¿ç”¨çš„ç«¯å£å·ä¸æ¡Œé¢å·çš„å…³ç³»
VNCæœåŠ¡ä½¿ç”¨çš„ç«¯å£å·ä¸æ¡Œé¢å·ç›¸å…³ï¼ŒVNCä½¿ç”¨TCPç«¯å£ä»5900å¼€å§‹ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹
æ¡Œé¢å·ä¸ºâ€œ1â€  ---- ç«¯å£å·ä¸º5901
æ¡Œé¢å·ä¸ºâ€œ2â€  ---- ç«¯å£å·ä¸º5902
æ¡Œé¢å·ä¸ºâ€œ3â€  ---- ç«¯å£å·ä¸º5903
â€¦â€¦
åŸºäºJavaçš„VNCå®¢æˆ·ç¨‹åºWebæœåŠ¡TCPç«¯å£ä»5800å¼€å§‹ï¼Œä¹Ÿæ˜¯ä¸æ¡Œé¢å·ç›¸å…³ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹
æ¡Œé¢å·ä¸ºâ€œ1â€  ---- ç«¯å£å·ä¸º5801
æ¡Œé¢å·ä¸ºâ€œ2â€  ---- ç«¯å£å·ä¸º5802
æ¡Œé¢å·ä¸ºâ€œ3â€  ---- ç«¯å£å·ä¸º5803
â€¦â€¦
åŸºäºä¸Šé¢çš„ä»‹ç»ï¼Œå¦‚æœLinuxå¼€å¯äº†é˜²ç«å¢™åŠŸèƒ½ï¼Œå°±éœ€è¦æ‰‹å·¥å¼€å¯ç›¸åº”çš„ç«¯å£ï¼Œä»¥å¼€å¯æ¡Œé¢å·ä¸ºâ€œ1â€ç›¸åº”çš„ç«¯å£ä¸ºä¾‹ï¼Œå‘½ä»¤å¦‚ä¸‹
[root@testdb ~]# iptables -I INPUT -p tcp --dport 5901 -j ACCEPT
[root@testdb ~]# iptables -I INPUT -p tcp --dport 5801 -j ACCEPT



é‡æ–°å¯åŠ¨vncserveræœåŠ¡çš„æ–¹æ³•ï¼š
[root@testdb ~]# vncserver -kill :1
[root@testdb ~]# vncserver :1


7.ä¿®æ”¹VNCè®¿é—®çš„å¯†ç 
ä½¿ç”¨å‘½ä»¤vncpasswdå¯¹ä¸åŒç”¨æˆ·çš„VNCçš„å¯†ç è¿›è¡Œä¿®æ”¹ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æœé…ç½®äº†ä¸åŒç”¨æˆ·çš„VNCéœ€è¦åˆ†åˆ«åˆ°å„è‡ªç”¨æˆ·ä¸­è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚åœ¨æˆ‘çš„è¿™ä¸ªå®éªŒä¸­ï¼Œrootç”¨æˆ·å’Œoracleç”¨æˆ·éœ€è¦åˆ†åˆ«ä¿®æ”¹ï¼Œä¿®æ”¹è¿‡ç¨‹å¦‚ä¸‹ï¼š
[root@testdb ~]# vncpasswd
Password:
Verify:
[root@testdb ~]#





8.æœ€åï¼Œéœ€è¦é…ç½®ä¸€ä¸‹é˜²ç«å¢™ï¼Œå…è®¸VNCå®¢æˆ·ç«¯è¿æ¥VNC serverã€‚VNC serverç›‘å¬çš„ç«¯å£ä»5900å¼€å§‹ï¼Œdisplay :1çš„ç›‘å¬5901ï¼Œdisplay :2ç›‘å¬5902ï¼Œä»¥æ­¤ç±»æ¨ã€‚CentOsçš„é˜²ç«å¢™ç¼ºçœæ˜¯ä¸å…è®¸è¿æ¥è¿™äº›ç«¯å£çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸‹é¢çš„æ­¥éª¤æ‰“å¼€é˜²ç«å¢™ï¼ˆéœ€è¦rootæƒé™)ï¼š
ã€€ã€€vi /etc/sysconfig/iptables
ã€€ã€€æ‰¾åˆ°ä¸‹é¢çš„è¯­å¥ï¼š
ã€€ã€€-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited
ã€€ã€€åœ¨æ­¤è¡Œä¹‹å‰ï¼ŒåŠ ä¸Šä¸‹é¢çš„å†…å®¹ï¼š
ã€€ã€€-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 5900:5903 -j ACCEPT
ã€€ã€€è¿™å¥è¯çš„å«ä¹‰æ˜¯ï¼Œå…è®¸å…¶å®ƒæœºå™¨è®¿é—®æœ¬æœºçš„5900åˆ°5903ç«¯å£ï¼Œè¿™æ ·ï¼Œdisplay:1, display:2, display:3çš„ç”¨æˆ·å°±å¯ä»¥è¿æ¥åˆ°æœ¬æœºã€‚
ã€€ã€€ç„¶åä½¿ç”¨rootèº«ä»½é‡æ–°å¯åŠ¨é˜²ç«å¢™ï¼š
ã€€ã€€/sbin/service iptables restart





202.196.120.157:1




========================================
|-- tightVNC: winè¿æ¥Ubuntu18æ¡Œé¢
----------------------------------------
https://www.tightvnc.com/







========================================
å…±äº«æ–‡ä»¶å¤¹ samba æœåŠ¡: win å’Œ linux å…±äº«æ–‡ä»¶ (å¯ä»¥å½“ nas ä½¿ç”¨)
----------------------------------------
1. ä»‹ç»
(1) ä½¿ç”¨åœºæ™¯ï¼š
- samba ç”¨äº win å’Œ linux ä¹‹é—´æ–‡ä»¶å…±äº«ã€‚
- ä»¥åŠä¸¤å° linux ä¹‹é—´æ–‡ä»¶å…±äº«ã€‚ å½“ç„¶ï¼Œlinuxä¹‹é—´æ–‡ä»¶å…±äº«æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ nfsã€‚

(2) å·¥ä½œæ¨¡å¼: C/S æ¨¡å¼ã€‚
å½“ç„¶ä½ è¦åœ¨linux(æœåŠ¡ç«¯)ä¸windows(å®¢æˆ·ç«¯)ä¹‹é—´äº’ç›¸èƒ½ping é€šã€‚

(3) å®˜ç½‘
https://www.samba.org/
Samba is the standard Windows interoperability suite of programs for Linux and Unix.
Sambaæ˜¯ç”¨äºLinuxå’ŒUnixçš„æ ‡å‡†Windowsäº’æ“ä½œæ€§ç¨‹åºå¥—ä»¶ã€‚




2. linux æœåŠ¡ç«¯çš„æ“ä½œ
æœåŠ¡ç«¯æ˜¯è™šæ‹Ÿæœº vm: Ubuntu 20.04.3 LTS (GNU/Linux 5.11.0-34-generic x86_64)

(1) åˆ›å»ºç›®å½•ï¼Œä½œä¸ºå…±äº«ç›®å½•
$ mkdir ~/usb3

æˆ–è€…æŒ‚è½½å¤–éƒ¨ç¡¬ä»¶
$ mkdir /mnt/usb 
$ mount /dev/sda1 /mnt/usb


(2)å®‰è£… samba æœåŠ¡
$ sudo apt install samba smbclient #Ubuntu
$ samba --version
Version 4.11.6-Ubuntu
$ apt list | grep samba #æŸ¥çœ‹ç›¸å…³åŒ…


## for CentOS
$ sudo yum install samba samba-common samba-client cifs-utils #CentOS
$ samba-regedit --version
Version 4.10.16
## æŸ¥è¯¢å®‰è£…è¿‡çš„åŒ…
$ rpm -qa | grep samba
samba-client-4.10.16-15.el7_9.x86_64
samba-common-libs-4.10.16-15.el7_9.x86_64
samba-libs-4.10.16-15.el7_9.x86_64
samba-common-tools-4.10.16-15.el7_9.x86_64
samba-4.10.16-15.el7_9.x86_64
samba-client-libs-4.10.16-15.el7_9.x86_64
samba-common-4.10.16-15.el7_9.noarch




(3) æ·»åŠ æœ¬åœ°ç”¨æˆ·ä¸ºsambaç”¨æˆ·å

tips: å¿…é¡»æ˜¯æœ¬åœ°ç”¨æˆ·åï¼ŒåŒæ—¶å¿…é¡»æ·»åŠ ä¸º sambaç”¨æˆ·åã€‚

$ sudo smbpasswd -a wang
è¾“å…¥2æ¬¡å¯†ç ã€‚
é‡å¯ã€‚
$ sudo smbd restart

æŸ¥çœ‹ç”¨æˆ·
$ sudo pdbedit -L
wang:1000:Wang Junliang

åˆ é™¤ç”¨æˆ·
smbpasswd -x   ç”¨æˆ·å



(4) ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šè¦å…±äº«çš„æ–‡ä»¶å¤¹
$ sudo vim /etc/samba/smb.conf 

é»˜è®¤æœ‰ä¸€ä¸ªå…¨å±€å˜é‡
[global]
	map to guest = bad user #å¢åŠ è¿™ä¸€è¡Œï¼Œåˆ™å…è®¸åŒ¿åè®¿é—®ï¼Œé€‚åˆå†…éƒ¨è®¿é—®

æœ€åæ–°å¢ä¸€å—ï¼Œè¦å»æ‰æ¯è¡Œçš„æ³¨é‡Š
[Public]
	comment=Public Storage
	path=/home/wang/usb3
	read only=no
	create mask=0755
	directory mask=0755
	force create mode = 0644
	force directory mode = 0755
	guest ok=yes
	browseable=yes
	writable=yes
	available = yes
	public = yes
	#æœ‰äººè¯´å¿…é¡»åŠ å¦‚ä¸‹å‡ è¡Œï¼Œå¦åˆ™ä¸å¯å†™
	force user = wang
	valid users = wang
	write list = wang

æ³¨é‡Š: 
comment=Public Storage   # æµè§ˆæ—¶æ˜¾ç¤ºçš„åå­—


ä¿å­˜åæ£€æŸ¥å‚æ•°
$ testparm

é‡å¯sambaæœåŠ¡
$ sudo systemctl restart smbd.service # for Ubuntu

$ sudo systemctl restart smb # for centOS
æˆ–
$ sudo service smbd status
$ sudo service nmbd status

$ sudo systemctl enable smbd



(5) æˆæƒç›®å½•æƒé™
$ sudo chmod -R 777 /home/wang/usb3/
drwxrwxrwx 2 wang wang 4.0K Sep 27 15:05 usb3


(6) æŸ¥è¯¢IP
$ ifconfig  #192.168.2.156







3. å®¢æˆ·ç«¯æœºå™¨ä¸Š æŸ¥çœ‹æ–‡ä»¶ 

(1) åœ¨å®¢æˆ·ç«¯æµ‹è¯• sudo apt-get install smbclient 

$ smbclient -L //192.168.2.156     ##æ²¡æœ‰å¯†ç ç›´æ¥å›è½¦ åŒ¿åç™»é™†

$ smbclient -L //192.168.2.156 -U wang
Enter WORKGROUP\wang's password: 

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	Public          Disk      Public Storage
	IPC$            IPC       IPC Service (wangVM server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available


==>æŠ¥é”™ï¼šsession setup failed: NT_STATUS_LOGON_FAILURE
## æœ¬åœ°æµ‹è¯•æ²¡é—®é¢˜
$ smbclient -L //127.0.0.1/Public -U jimmy
æ¢å¦ä¸€å°ä¸»æœº
$ smbclient -L //192.168.2.156/Public -U jimmy
å‘ç°ï¼šå°é”®ç›˜è«åå…¶å¦™çš„ä¸è¯†åˆ«ï¼ä½¿ç”¨é¡¶éƒ¨æ•°å­—é”®å³å¯ã€‚



(2) ä¸´æ—¶æŸ¥çœ‹æ–‡ä»¶
$ smbclient //192.168.2.156/Public -U wang
Enter WORKGROUP\wang's password: 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Mon Sep 27 15:08:51 2021
  ..                                  D        0  Mon Sep 27 15:08:51 2021
  a.txt                               N       10  Mon Sep 27 15:08:37 2021
  b                                   N       10  Mon Sep 27 15:08:51 2021

		9736500 blocks of size 1024. 1728328 blocks available
smb: \> exit




## for centOS: SELinux ä½œæ€ª
$ sudo setsebool -P samba_export_all_ro on
$ sudo systemctl restart smb.service




(3) åœ¨windowsè®¿é—®å®¢æˆ·ç«¯æŒ‚è½½è®¿é—®

win+Ræ‰“å¼€è¿è¡Œçª—å£ï¼Œè¾“å…¥ä¸¤ä¸ªåæ–œçº¿åŠ ä¸ŠsambaæœåŠ¡å™¨çš„åœ°å€ \\192.168.2.156\Public
æ²¡è®©è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œéƒ¨åˆ†å¯å†™ï¼šå¯ä»¥æ–°å»ºå¹¶ä¿®æ”¹ï¼Œä½†åŸæ¥çš„æ–‡ä»¶æ˜¯åªè¯»çš„ã€‚ //todo

æ‰“å¼€ æˆ‘çš„ç”µè„‘ï¼Œé¡¶éƒ¨ æ·»åŠ ä¸€ä¸ªç½‘ç»œä½ç½®
è¾“å…¥  \\192.168.2.156\Public
åå­— éšä¾¿å†™ï¼Œæ¯”å¦‚ sambaOnVM

ç„¶åè¿™ä¸ªç½‘ç»œä½ç½®å°±å›ºå®šåˆ°æˆ‘çš„ç”µè„‘äº†ã€‚

åœ¨windowsä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œåˆ°Linuxä¸‹çœ‹çœ‹å§ï¼
åœ¨Linuxçš„å…±äº«ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œåœ¨windowsä¸‹çœ‹çœ‹å§ï¼




(4) Linux å®¢æˆ·ç«¯æŒ‚è½½ï¼Œåƒnasä¸€æ ·å¥½ç”¨ã€‚
1) å®‰è£… cifs 
$ sudo apt install cifs-utils
$ ls -lth /sbin/mount.*

2) æŒ‚è½½
$ sudo mount -v -t cifs -o username=wang,password=123456,uid=1001,gid=1001,rw //192.168.2.156/Public ~/LocalDIR
mount.cifs kernel mount options: ip=192.168.2.156,unc=\\192.168.2.156\Public,uid=1001,gid=1001,user=wang,pass=********

è­¦å‘Šï¼š1001æ›¿æ¢æˆä½ åœ¨Ubuntuä¸Šçš„æ•°å­—UIDå’ŒGIDï¼Œå¦åˆ™æŒ‚è½½åçš„å…±äº«æ–‡ä»¶å¤¹æ‰€æœ‰è€…æ˜¯rootï¼Œå°±æ˜¯åªè¯»ï¼
ã€€ã€€å¯ç”¨ä¸‹é¢å‘½ä»¤æ‰¾å‡ºä½ çš„æ•°å­—uid: $ id <ç”¨æˆ·å>

## for centOS7 //æ²¡æµ‹è¯•è¿‡
$ sudo mount.cifs //172.18.5.193/Public ~/LocalDIR -o user=wangjl,sec=ntlmssp 


3) è¯»å†™æµ‹è¯•
$ ls -lth LocalDIR
total 16K
-rwxr-xr-x 1 wangjl wangjl   5 Oct  8 16:04 a

$ touch LocalDIR/a2
$ ls -lth LocalDIR
total 16K
-rwxr-xr-x 1 wangjl wangjl   0 Oct  8 21:31 a2


4) å®¢æˆ·ç«¯æ°¸ä¹…æŒ‚è½½:
$ sudo vim /etc/fstab
//192.168.2.156/Public /home/wangjl/LocalDIR cifs username=wang,password=123456,uid=1001,gid=1001 0 0 
æŒ‚è½½ç”Ÿæ•ˆ
$ sudo mount -a

5) å¸è½½
$ sudo umount local-mount-point






(5) æ’é”™ï¼šä¸€ä¸ªå®¢æˆ·ç«¯ä¸èƒ½ç™»é™†å¤šä¸ªè´¦å·ï¼ŒåŒæ—¶æœ€å¤šä¸€ä¸ªç™»å½•ã€‚
$ mount | grep Public
//172.18.5.193/Public on /home/wangjl/LocalDIR type cifs (rw,relatime,vers=default,cache=strict,username=wangjl,domain=,uid=0,noforceuid,gid=0,noforcegid,addr=172.18.5.193,file_mode=0755,dir_mode=0755,soft,nounix,serverino,mapposix,rsize=1048576,wsize=1048576,echo_interval=60,actimeo=1)

å¸è½½
$ sudo umount /home/wangjl/LocalDIR







(6) æµ‹è¯• åœ¨ centOS7 åšæœåŠ¡å™¨ï¼ŒUbuntuåšå®¢æˆ·ç«¯

$ smbclient -L //x.biomooc.com -U wangjl
Enter WORKGROUP\wangjl's password: 

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	Public          Disk      Public Storage
	IPC$            IPC       IPC Service (Samba 4.10.16)
	wangjl          Disk      Home Directories
SMB1 disabled -- no workgroup available


æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªYeså’ŒNoæ˜¯é¦–å­—æ¯å¤§å†™ã€‚
[Public]
	comment=Public Storage
	path=/home/wangjl/usb3
	read only=No
	create mask=0777
	directory mask=0777
	guest ok=Yes
	browseable=Yes
	writable=Yes
	# 
	force user = wangjl
	valid users = wangjl
	write list = wangjl

$ sudo service smb restart


å®¢æˆ·ç«¯
$ smbclient //x.biomooc.com/Public -U wangjl
Enter WORKGROUP\wangjl's password: 
Try "help" to get a list of possible commands.
smb: \> mkdir wjl
NT_STATUS_ACCESS_DENIED making remote directory \wjl
è¿˜æ˜¯åªè¯»ï¼Œä¸èƒ½å†™ã€‚


æœåŠ¡ç«¯æ‰§è¡Œ https://blog.csdn.net/m0_37582216/article/details/106960726
$ chcon -R -t samba_share_t ~/usb3/
## chcon - change file SELinux security context
è¿˜æ˜¯ä¸ç†è§£ SELinux å•¥ä½œç”¨ï¼Ÿ //todo


å®¢æˆ·ç«¯æŒ‚è½½
$ sudo mount -v -t cifs -o username=wangjl,password=123456,uid=1001,gid=1001,rw //172.18.5.193/Public ~/v193

$ cd ~/v193
$ touch b
å¯å†™ã€‚









2. ç«¯å£
(1) samba ç«¯å£å·æ˜¯å¤šå°‘ï¼Ÿ åŸæ¥æ˜¯137,138, ç°åœ¨æ˜¯139,445
$ vim /etc/services

netbios-ns      137/tcp     # NETBIOS Name Service
netbios-ns      137/udp
netbios-dgm     138/tcp     # NETBIOS Datagram Service
netbios-dgm     138/udp
netbios-ssn     139/tcp     # NETBIOS session service
netbios-ssn     139/udp

microsoft-ds    445/tcp
microsoft-ds    445/udp

$ sudo netstat -anop | grep smb
tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN      95797/smbd           off (0.00/0/0)
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN      95797/smbd           off (0.00/0/0)
tcp6       0      0 :::139                  :::*                    LISTEN      95797/smbd           off (0.00/0/0)
tcp6       0      0 :::445                  :::*                    LISTEN      95797/smbd           off (0.00/0/0)


(2) æ‰“å¼€é˜²ç«å¢™ä¸€ä¸ªå‡ºå£
æˆ‘ä»¬çœ‹åˆ°ä½¿ç”¨äº†tcpçš„139å’Œ445ç«¯å£ï¼Œudpçš„137å’Œ138ç«¯å£ã€‚åœ¨é˜²ç«å¢™ä¸­å…è®¸é€šè¡Œï¼š
åœ¨åæ¥çš„æµ‹è¯•ä¸­ï¼Œä»…å…è®¸tcpåè®®çš„139ç«¯å£é€šè¿‡ä¹Ÿèƒ½è®¿é—®åˆ°å…±äº«ã€‚

$ sudo iptables -A INPUT -p tcp --dport 139 -j ACCEPT




ref: 
https://www.howtoforge.com/how-to-install-samba-server-on-centos-8/
https://www.cnblogs.com/bandiao/p/10862226.html
https://adrianmejia.com/how-to-set-up-samba-in-ubuntu-linux-and-access-it-in-mac-os-and-windows/


winä½œä¸ºæœåŠ¡å™¨: https://www.cnblogs.com/mountain2011/p/7352708.html








========================================
|-- ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ (NFS, Network File System): ä¸¤å° linux ä¹‹é—´æ–‡ä»¶å…±äº« //todo
----------------------------------------
ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œè‹±æ–‡Network File System(NFS)ï¼Œæ˜¯ç”±SUNå…¬å¸ç ”åˆ¶çš„UNIXè¡¨ç¤ºå±‚åè®®(presentation layer protocol)ï¼Œèƒ½ä½¿ä½¿ç”¨è€…è®¿é—®ç½‘ç»œä¸Šåˆ«å¤„çš„æ–‡ä»¶å°±åƒåœ¨ä½¿ç”¨è‡ªå·±çš„è®¡ç®—æœºä¸€æ ·ã€‚









========================================
é›†ç¾¤ ä¸ åˆ†å¸ƒå¼
----------------------------------------
1. æ¦‚å¿µ
(1) åŠŸèƒ½ä¸Š
é›†ç¾¤æ¯ä¸€å°æœåŠ¡å™¨å®ç°çš„åŠŸèƒ½æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚åˆ†å¸ƒå¼æ¯ä¸€å°å®ç°çš„åŠŸèƒ½æ˜¯æœ‰å·®å¼‚çš„

åˆ†å¸ƒå¼ï¼šä¸€ä¸ªä¸šåŠ¡åˆ†æ‹†å¤šä¸ªå­ä¸šåŠ¡ï¼Œéƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š
é›†ç¾¤ï¼šåŒä¸€ä¸ªä¸šåŠ¡ï¼Œéƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Š

(2) è·‘çš„ä»£ç ä¸Š
é›†ç¾¤ï¼šä¸åŒçš„æœåŠ¡å™¨è¿è¡ŒåŒæ ·çš„ä»£ç ï¼Œå¹²åŒä¸€ä»¶äº‹
åˆ†å¸ƒå¼ï¼šä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿è¡Œä¸åŒçš„ä»£ç ï¼Œä¸ºäº†åŒä¸€ä¸ªç›®çš„







========================================
|-- é›†ç¾¤ç®¡ç†å·¥å…·(SGE, Sun Grid Engine): qsub //todo
----------------------------------------
1. ç®€ä»‹ 
SGEæˆ–è€…å…¶ä»–é›†ç¾¤ç®¡ç†å·¥ä½œåšçš„äº‹æƒ…å°±æ˜¯å°†ç”¨æˆ·æŠ•é€’çš„ä»»åŠ¡è¿›è¡Œæ’é˜Ÿï¼Œç„¶åå°†ä»»åŠ¡äº¤ç»™èƒ½å¤Ÿè¿è¡Œçš„ç»“ç®—èŠ‚ç‚¹æ‰§è¡Œï¼Œå·¥ä½œæµç¨‹å¯ä»¥åˆ†ä¸ºå››æ­¥:
- æ¥å—ç”¨æˆ·æŠ•æ”¾çš„ä»»åŠ¡
- åœ¨ä»»åŠ¡è¿è¡Œä»¥å‰ï¼Œå°†ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªå­˜å‚¨åŒºåŸŸ
- å‘é€ä»»åŠ¡åˆ°ä¸€ä¸ªæ‰§è¡Œè®¾å¤‡ï¼Œå¹¶ç›‘æ§ä»»åŠ¡çš„è¿è¡Œ
- è¿è¡Œç»“æŸå†™å›ç»“æœå¹¶è®°å½•è¿è¡Œæ—¥å¿—


2. ubuntu æµ‹è¯•
(1) å®‰è£…
$ qsub
Command 'qsub' not found, but can be installed with:

sudo apt install gridengine-client  # version 8.1.9+dfsg-9build2, or
sudo apt install slurm-wlm-torque   # version 19.05.5-1


ç½‘å‹æé—®ï¼š
- è€å¸ˆçš„ SGE ç”¨çš„æ˜¯å•†ä¸šï¼Œè¿˜æ˜¯å…è´¹å¼€æºç‰ˆæœ¬ï¼Ÿ
- ä¸¤å°æœåŠ¡å™¨å¯ä»¥æœ€å°åŒ–æ¨¡æ‹Ÿä¹ˆï¼Ÿ
- æˆ‘æœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡SGEæ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œè¿è¡Œqsubæ¥æ‰§è¡Œç›¸å…³çš„è¿è¡Œç¨‹åºå‘¢ğŸ¤”å¾ˆå¤šæ•™ç¨‹ç”¨è™šæ‹Ÿæœºæ¥æ¨¡æ‹Ÿè¿™ä¸ªï¼Œä¸æ™“å¾—æ˜¯ä¸æ˜¯ä¸€ä¸ªé“ç†?



(2) 
åœ¨ä¸»æ§èŠ‚ç‚¹ä¸Šå®‰è£… 











(2) SGEçš„å¸¸ç”¨å‘½ä»¤

1) ä»»åŠ¡æŠ•é€’

SGEä¸­æŠ•é€’ä»»åŠ¡æ‰€ç”¨åˆ°çš„å‘½ä»¤æ˜¯qsub. æœ€ç®€å•çš„ç”¨æ³•æ˜¯ä¸‹é¢è¿™ç§ï¼Œå³,å°†è¦æ‰§è¡Œçš„å‘½ä»¤é€šè¿‡æ ‡å‡†è¾“å…¥çš„æ–¹å¼ä¼ é€’ç»™qsub
$ echo "ls -l " | qsub


2) æŠ•é€’ä¹‹åå¯ä»¥ç”¨qstatæŸ¥çœ‹è‡ªå·±æŠ•é€’çš„ä»»åŠ¡çš„è¿è¡Œæƒ…å†µ

ç¬¬ä¸€åˆ—æ˜¯ä»»åŠ¡ç¼–å·, ç¬¬äºŒåˆ—æ˜¯ä¼˜å…ˆçº§ï¼Œç¬¬ä¸‰åˆ—æ˜¯ä»»åŠ¡åå­—ï¼Œåœ¨å‚æ•°é‡Œæ²¡æœ‰ç‰¹åˆ«è¯´æ˜çš„æƒ…å†µä¸‹ï¼ŒSGEä¼šç”¨ä»»åŠ¡çš„æ¥æºè¿›è¡Œå‘½ä»¤ï¼ŒSTDINè¡¨ç¤ºæ¥è‡ªäºæ ‡å‡†è¾“å…¥ï¼Œ
ç¬¬å››åˆ—æ˜¯ç”¨æˆ·åï¼Œ
ç¬¬äº”åˆ—æ˜¯è¿è¡ŒçŠ¶æ€("r"è¡¨ç¤ºè¿è¡Œä¸­), 
ç¬¬å…­åˆ—è¡¨ç¤ºä»»åŠ¡æŠ•é€’å’Œå¼€å§‹æ—¶é—´ï¼Œ
ç¬¬ä¸ƒåˆ—æ˜¯ä»»åŠ¡æŠ•é€’çš„èŠ‚ç‚¹ï¼Œ
ç¬¬8åˆ—åˆ™æ˜¯è¦ç”³è¯·çš„çº¿ç¨‹æ•°ã€‚

åœ¨æ‰§è¡Œå®Œæˆåä¼šåœ¨å®¶ç›®å½•ä¸‹ç”Ÿæˆ"STDIN.e7883"å’Œ"STDIN.o7883", å…¶ä¸­7883å°±æ˜¯ä»»åŠ¡ç¼–å·, å‰è€…å­˜æ”¾æ ‡å‡†é”™è¯¯è¾“å‡º, åè€…å­˜æ”¾æ ‡å‡†è¾“å‡ºï¼Œ å› æ­¤"cat STDIN.o7883"çš„å†…å®¹å°±æ˜¯ls -lçš„å†…å®¹ã€‚


3) å¦ä¸€ç§æ–¹æ³•æ˜¯å…ˆå†™ä¸€ä¸ªè„šæœ¬ç„¶åæŠ•é€’ï¼Œæ¯”å¦‚å…ˆç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶"ls.sh", å†…å®¹å¦‚ä¸‹ï¼Œç„¶åç”¨"qsub ls.sh"æŠ•é€’ä»»åŠ¡ã€‚
ls -l
è·Ÿä¹‹å‰ä¸€æ ·ï¼Œæœ€ååœ¨å®¶ç›®å½•ä¸‹äº§ç”Ÿäº†"ls.sh.exxxx"å’Œ"ls.sh.exxxx"ä¸¤ä¸ªæ–‡ä»¶




(3) å¸®åŠ©æ–‡ä»¶

å½“ç„¶å®é™…æ—¶è‚¯å®šæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ å„ç§å‚æ•°æ¥è°ƒæ•´qsubçš„è¡Œä¸ºï¼Œ
ç”¨qsub -helpå¯ä»¥çœ‹å®Œæ•´çš„å‚æ•°ï¼Œä½†æ˜¯å¸¸ç”¨çš„ä¸ºå¦‚ä¸‹å‡ ä¸ª

-q xxx : æŒ‡å®šè¦æŠ•é€’åˆ°çš„é˜Ÿåˆ—ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼ŒSGEä¼šåœ¨ç”¨æˆ·å¯ä½¿ç”¨çš„é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„é˜Ÿåˆ—ã€‚
-Vï¼š å°†å½“å‰çš„ç¯å¢ƒå˜é‡ä¼ é€’åˆ°æ‰§è¡Œå‘½ä»¤çš„èŠ‚ç‚¹ä¸­
cwd: åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œä»»åŠ¡, sgeçš„æ—¥å¿—ä¼šè¾“å‡ºåˆ°å½“å‰è·¯å¾„ã€‚ ä¸å¢åŠ è¯¥æŒ‡ä»¤ï¼Œæ‰€æœ‰æŠ•é€’çš„ä»»åŠ¡éƒ½ä¼šåœ¨å®¶ç›®å½•ä¸‹æ‰§è¡Œ
-l resource=value: è¯·æ±‚èµ„æºæ•°, ä¾‹å¦‚ -l vf=25G -l h=node1 å°±æ˜¯ä»»åŠ¡çš„é¢„ä¼°å†…å­˜è¦25G(å†…å­˜ä¼°è®¡çš„å€¼åº”ç¨å¾®å¤§äºçœŸå®çš„å†…å­˜ï¼Œå†…å­˜é¢„ä¼°åå°å¯èƒ½ä¼šå¯¼è‡´èŠ‚ç‚¹è·‘æŒ‚), ç”³è¯·åœ¨node1ä¸Šè¿è¡Œ
-S /bin/bash: è¡¨ç¤ºåœ¨bashç¯å¢ƒä¸‹æ‰§è¡Œå‘½ä»¤ã€‚é»˜è®¤tcsh.
-pe openmpi 4: è¡¨ç¤ºä½¿ç”¨openmpiè¿›è¡Œå¹¶è¡Œè¿ç®—ï¼Œä¸”ç”³è¯·çš„çº¿ç¨‹æ˜¯4ï¼Œ
-N ä»»åŠ¡å: æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡çš„åå­—
-j y|n ï¼šæ˜¯å¦å°†æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å…¥åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶
-sync y|n: æ˜¯å¦ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œè¿”å›é€€å‡ºç 
-o path: æŒ‡å®šæ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶å¤¹


ä¾‹å¦‚åœ¨å‘½ä»¤è¡Œé‡ŒæŠ•é€’ä¸€ä¸ªæ¯”å¯¹ä»»åŠ¡
$ echo "bowtie2 -p 8 -x index/ref -1 data/A_1.fq -2 data/A_2.fq | samtools sort > A.bam" | qsub -V -cwd -l vf=25G -S /bin/bash -pe openmpi 8 -N A.bt2

è¿™äº›å‚æ•°é™¤äº†åœ¨å¤–éƒ¨è®¾ç½®å¤–ï¼Œè¿˜å¯ä»¥åœ¨shellè„šæœ¬é‡Œè®¾ç½®ï¼Œå¦‚ä¸‹

#!/bin/bash
#$ -S /bin/bash
#$ -V
#$ -cwd
#$ -l vf=25G
#$ -pe openmpi 8
#$ -N a.bt2
bowtie2 -p 8 -x index/ref -1 data/A_1.fq -2 data/A_2.fq | samtools sort > A.bam



(4) æŸ¥è¯¢ä»»åŠ¡
é™¤äº†ä»»åŠ¡æŠ•é€’å¤–ï¼ŒæŸ¥è¯¢ä»»åŠ¡ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å‘½ä»¤ï¼Œé™¤äº†åˆšæ‰ç›´æ¥ç”¨qstatæŸ¥çœ‹ï¼Œè¿˜æœ‰å¦‚ä¸‹å‚æ•°æ¯”è¾ƒå¥½ç”¨

qstat -f        # æŸ¥çœ‹ç”¨æˆ·ä»»åŠ¡
qstat -j jobId  # æŒ‰ä»»åŠ¡idæŸ¥çœ‹
qstat -explain a|c|A|E -j jobID # æŸ¥çœ‹ä»»åŠ¡ä»»åŠ¡å¹¶ç»™å‡ºè§£é‡Š
qstat -u user   # æŒ‰ç”¨æˆ·æŸ¥çœ‹


(5) ä»»åŠ¡çŠ¶æ€ï¼š

qw: è¡¨ç¤ºç­‰å¾…çŠ¶æ€
hqw: ä»»åŠ¡æŒ‚èµ·ç­‰å¾…ä¸­ï¼Œå¾…ä¾èµ–çš„ä»»åŠ¡å®Œæˆåæ‰§è¡Œ
Eqw: æŠ•é€’ä»»åŠ¡å‡ºé”™
r: è¡¨ç¤ºä»»åŠ¡æ­£åœ¨è¿è¡Œ
s: æš‚æ—¶æŒ‚èµ·
dr: èŠ‚ç‚¹æŒ‚äº†ä¹‹åï¼Œåˆ é™¤ä»»åŠ¡å°±ä¼šå‡ºç°è¿™ä¸ªçŠ¶æ€ï¼Œåªæœ‰èŠ‚ç‚¹é‡å¯ä¹‹åï¼Œä»»åŠ¡æ‰ä¼šæ¶ˆå¤±

(6) åˆ é™¤ä»»åŠ¡
ä»»åŠ¡åˆ é™¤ä¹Ÿæ¯”è¾ƒé‡è¦ï¼Œæ¯•ç«Ÿå¶å°”ä¼šå‡ºç°ä»»åŠ¡æŠ•é€’å‡ºé”™çš„æƒ…å†µ
$ qdel -j 1111   åˆ é™¤ä»»åŠ¡å·ä¸º1111çš„ä»»åŠ¡



(7) å…¶ä»–å‘½ä»¤
qrshï¼šä¸qsubç›¸æ¯”ï¼Œæ˜¯äº¤äº’å¼çš„æŠ•é€’ä»»åŠ¡ï¼Œæ³¨æ„å‚æ•°:-now yes|noé»˜è®¤è®¾ç½®ä¸ºyes
- è‹¥è®¾ç½®ä¸ºyesï¼Œç«‹å³è°ƒåº¦ä½œä¸šï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨èµ„æºï¼Œåˆ™æ‹’ç»ä½œä¸šï¼Œä»»åŠ¡æŠ•é€’å¤±è´¥ï¼Œä»»åŠ¡çŠ¶æ€ä¸ºEqwã€‚
- è‹¥è®¾ç½®ä¸ºnoï¼Œè°ƒåº¦æ—¶å¦‚æœæ²¡æœ‰å¯ç”¨èµ„æºï¼Œåˆ™å°†ä½œä¸šæ’å…¥é˜Ÿåˆ—ï¼Œç­‰å¾…è°ƒåº¦ã€‚
- ä¾‹å­ï¼š qrsh -l vf=*G -q all.q -now no -w n *sh


qacct ä»é›†ç¾¤æ—¥å¿—ä¸­æŠ½å–ä»»æ„è´¦æˆ·ä¿¡æ¯
qalter æ›´æ”¹å·²æäº¤ä½†æ­£å¤„äºæš‚æŒ‚çŠ¶æ€çš„ä½œä¸šçš„å±æ€§
qconf ä¸ºé›†ç¾¤å’Œé˜Ÿåˆ—é…ç½®æä¾›ç”¨æˆ·ç•Œé¢
- qconf -splæŸ¥çœ‹å¯ç”¨å¹¶è¡Œç¯å¢ƒ

qhold é˜»æ­¢å·²æäº¤ä½œä¸šçš„æ‰§è¡Œ
qhost æ˜¾ç¤ºSGEæ‰§è¡Œä¸»æœºï¼ˆå³å„ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼‰çš„çŠ¶æ€ä¿¡æ¯
- qhost -jæŒ‰ç…§èŠ‚ç‚¹æ˜¾ç¤ºä»»åŠ¡
- qhost -Få±•ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„èµ„æº

qlogin å¯åŠ¨telnetæˆ–ç±»ä¼¼çš„ç™»å½•ä¼šè¯ã€‚



(8) æ¡ˆä¾‹ï¼šä¸€ä¸ªæŠ•é€’æ¯”å¯¹ä»»åŠ¡çš„ç®€å•è„šæœ¬
#!/bin/bash

set -e
set -u
set -o pipefail

threads=8
index=index/hg19

FQ_DIR="analysis/0-raw-data"
ALIGN_DIR="analysis/2-read-align"
LOG_DIR="analysis/log"
TMP_DIR="analysis/tmp"

mkdir -p ${ALIGN_DIR}
mkdir -p ${LOG_DIR}
mkdir -p ${TMP_DIR}

tail -n+2 download_table.txt | cut -f 6 | while read id;
do
    echo "
    bowtie2 --very-sensitive-local --mm -p $threads -x $index -U ${FQ_DIR}/$id.fastq.gz 2> ${LOG_DIR}/$id.bt2.log | \
    samtools sort -@ 2 -m 1G -T ${TMP_DIR}/${id} -o ${ALIGN_DIR}/${id}.sort.bam" | qsub -V -cwd -pe openmpi $threads -N ${id}_bt2 -q all.q -S /bin/bash
done







ref:
https://www.jianshu.com/p/b7b540a3c015
https://blog.csdn.net/wuxianfeng1987/article/details/72874905





========================================
----------------------------------------



========================================
----------------------------------------




========================================
----------------------------------------



========================================
----------------------------------------




========================================
----------------------------------------



========================================
----------------------------------------




========================================
----------------------------------------



========================================
----------------------------------------


